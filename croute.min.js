/*!
 * conkitty-route v0.5.0, https://github.com/hoho/conkitty-route
 * (c) 2014 Marat Abdullin, MIT license
 */
window.$CR=function(e,t,n,r,i){"use strict";function a(e,t,r,i){for(t=[],r=0;r<e.length;r++)i=e[r],t.push(n(i.name)+"="+n(i.value));return t.join("&")}function o(e,t,n,r,i,a,f){for(n&&n(e),e._w=0,i=e.children,r=0;r<i.length&&(f=o(a=i[r],t,n),e.wait&&(e._w+=a._w),!f);r++);return t(e)}function f(e,t,n,r,a){var o=t.state,f=n[0],c=o?o.call(e,f,r,a):i,u=n[2];n[2]=r,c===i&&(r===et&&u===nt&&(f.disabled=!1),r===nt&&(f.disabled?n[2]=u:f.disabled=!0))}function c(e,t,n){var r,i=t._fi;for(r=0;r<i.length;r++)f(e,t,i[r],n)}function u(e,t,n){n=new y(e,t),J.push(n)}function s(e){return"function"==typeof e}function l(e){return e instanceof Array}function h(e){return"string"==typeof e}function p(e){return e instanceof Node}function d(e){!!I!=!!e&&_("Running: "+!!I)}function _(e){throw new Error(e)}function m(e,t,n,r,i,a){if(r=G[e]){if(t=t.isForm?t[ut]:t,n=[e].concat(n||[]),(a=t._id)&&(i=r[a]))for(a=0;a<i.length;a++)i[a].apply(t,n);if(i=r[""])for(a=0;a<i.length;a++)i[a].apply(t,n)}}function g(e,t,n,r,i){return i="?"===e.charAt(1)?2:1,e=e.substring(i),e in t&&!n&&_("Duplicate param"),t[e]=i,e={param:e,optional:2===i},r&&r.push(e),r?"(?:/([^/]+))"+(2===i?"?":""):e}function v(e,n,r){var a,o,f,c,u,s,l,h={},p=[],d=[];for((e||"").replace(/^((?:(?:\:\?)|[^?#])*)(?:\?([^#]*))?(?:#(.*))?$/,function(e,t,n,r){a=(t||"").split("/"),o=(n||"").split("&"),f=r}),s=a.length,c=0;s>c;c++)((u=t(a[c]))||r&&c===s-1)&&p.push(":"===u.charAt(0)?g(u,h,n,n?i:d):n?u:"/"+u.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"));for(c=0;c<o.length;c++)(u=o[c])&&(l||(l={}),~(s=u.indexOf("="))?(s=u.substring(s+1),u=t(u.substring(0,u.length-s.length-1)),s=t(s)):s=lt,":"===u.charAt(0)&&_("Invalid queryparam"),u in l&&_("Duplicate queryparam"),l[u]=s&&":"===s.charAt(0)?g(s,h,n):{value:s});return f&&(f=":"===f.charAt(0)?g(f,h,n):{value:f}),{pathname:[p,d],search:l,hash:f,params:h}}function w(e,t,n,r,a,o,f,c){switch(n.param&&r&&(f=r[n.param]),!0){case"value"in n?n.value===t:t!==i&&!f:c=!0;break;case s(f):c=(t=f(t))!==i||n.optional;break;case t===i&&n.optional:c=!0;break;case f instanceof RegExp&&t!==i:c=f.test(t);break;case l(f):c=f.indexOf(t)>=0;break;case h(f):c=f===t;break;default:c=!1}return c&&t!==i&&(e!==i&&(a[e]=t),n&&n.param&&(o[n.param]=t)),c}function b(e,t){if(t=e._a)for(;e;)e._a-=t,e=e[ut]}function y(e,t,n,r,a,o){var f,c,u,p,d,m,g,j,x,C,$,A,E,F=this,R=/.*/,T={};if(F[ut]=a,F.children=[],F.uri=e,F._id="r"+ ++P,F._n={},t)if(F.title=t.title||a&&a.title,F[st]=t[ut]||a&&a[st],F.render=k(t.render),o)F.isForm=!0,F.action=t.action,F._method=t.method,F.check=t.check,F.state=t.state,F.type=t.type,F[ct]=t[ct];else{$=t.params,(f=F.id=t.id)&&(f in z&&_("Duplicate id: "+f),z[f]=F),A=t.matcher,F.break=t.break,F.keep=t.keep,F.final=t.final,F.reduce=t.reduce,l(u=t.data)?F._da=!0:u=u!==i?[u]:[];for(f=0;f<u.length;f++)p=u[f],p&&(_t(2,p)||h(p.uri||p)||s(p.uri||p.then||p))||_("Unexpected `"+p+"` as data source");if(F[Y]=u,F.form=t.form,F.wait=((f=t.wait)===i?a&&a.wait:f)||!1,d=t.on)for(p in G)if(u=d[p])for(l(u)||(u=[u]),f=0;f<u.length;f++)vt.on(p,u[f],F)}if(e!==i&&(e=v(e),E=(n||[]).concat(e.pathname[0]),g=new RegExp(E.join("")+"(?:/(.*))?"),j=e.pathname[1],x=e.search,C=e.hash,r||(r=1),R=function(e){T={};var t,n=e.match(g);if(n){for(t=j.length;t--;)if(!w(i,n[r+t],j[t],$,i,T)){t=!1;break}if(t===!1||!x&&!C&&A&&!A.call(F,T))return b(F),!1;if((F._d=!n[r+j.length])&&F.final!==!1)for(F._a=1,t=a;t;)t._a++,t=t[ut]}return F._a?T:!1},(x||C)&&(R={pathname:R},x&&(R.search=function(){var e,t={};for(e in x)if(!w(e,S[e],x[e],$,t,T)){t=!1;break}return(t===!1||!C&&A&&!A.call(F,T))&&(b(F),t=!1),t}),C&&(R.hash=function(e){var t=!w(i,e||i,C,$,i,T)||A&&!A.call(F,T)?!1:e||!0;return t||b(F),t})),c=t&&t.frames))for(u in c)m=new y(u,c[u],F.reduce===!1?n:E,r+(F.reduce===!1?0:j.length),F),F.children.push(m);$H.on(R,{go:function(t){e||(F._a=1),F._p=T,F._s=t},leave:function(){F._p=lt}})}function k(e){function t(e){return h(e)||s(e)||_t(3,e)||e===lt}e=t(e)||l(e)?{success:e}:e||{};var n,r,a,o,f,c,u,p={},d=[rt,it,at,ot,ft],m={"-":!1,"":i,"+":!0};for(n=d.length;n--;){r="",c=i;for(r in m)if(l(f=e[r+(o=d[n])])||f===i||(f=[f]),f){for(c||(c=[]),a=0;a<f.length;a++)t(u=f[a])||_("Unexpected `"+u+"` as a template"),c.push({s:m[r],v:u});p[o]=c}}return p}function j(e,t,n,r,a){return a=t.param,r=n&&a in n?n[a]:(r=e&&e._p)?r[a]:i}function x(e,t,r,a,o,f,c,u){var s,h,p,d,_;if(f||(a=[],o=[],f={}),!e||e&&e.reduce!==!1){for(t=v(t,!0,!r),p=t.pathname[0],s=p.length;s--;)d=p[s],_=d.param?j(e,d,r):d,_!==i&&a.unshift(n(_));if(p=t.search)for(s in p)if(!(s in f)){if(f[s]=!0,d=p[s],s=n(s),d.param){if(_=j(e,d,r),l(_)){for(h=0;h<_.length;h++)o.push(s+"="+n(_[h]));continue}}else _=d.value;_!==i&&o.push(s+"="+n(_))}!c&&(p=t.hash)&&(c=p.param?j(e,p,r):p.value)}return r&&e&&(s=e[ut])&&x(s,s.uri,r,a,o,f,c,!0),u?void 0:(a=("/"+a.join("/")).replace(/\/+/g,"/"),o.length&&(a+="?"+o.join("&")),c&&(a+="#"+n(c)),a)}function C(e,t,n,r,a,o,f,c,u,l,p){if(a=this,p=t.method,t=t.isForm?t[ut]:t,!h(e)){if((f=e.override)&&(f=f.call(t,t._p))!==i)return{d:f};o=e.parse,c=e.transform,e=e.uri,s(e)&&(e=e.call(t,t._p),l=!0)}return a.ok=[],a.err=[],a.r=r=new XMLHttpRequest,r.open(p||"GET",r.uri=l?e:x(t,e),!0),r.onreadystatechange=function(){if(4===r.readyState){if(a.d=a.e=!0,200===r.status)try{u=r.responseText,u=o?o.call(t,u,r):JSON.parse(u),a.j=c?c.call(t,u,r):u,a.e=!1}catch(e){}a.done(),a.r=i}},n&&(n=n(r)),n===ht?n:void r.send(n)}function $(t,n,r,a,o,f){return a=n,t=t.isForm?t[ut]:t,h(r)&&(r=i),n=n||r||D,n&&!p(n)&&(n=s(n)?n.call(t):e.querySelector(n)),p(n)?((o=n._$Cid)||(n._$Cid=o=++P),f=t._n,f[o]||(f[o]=[r=e.createComment("")],n.appendChild(r))):n="No node `"+a+"`"+((a=t.id)?" ("+a+")":""),n}function A(t,n,r,a,o,f,c,u){var d,g,v,w,b,y,k,j,x,C,F,R,T="nextSibling";if(u=u===i?n[t]||N[t]||[]:u.s===i||u.s===o.active(!0)?u.v:i,l(u)){if(t===ft&&!u.length)throw r[0];try{for(c={},d=0;d<u.length&&A(t,n,r,a,o,f,c,u[d])!==!1;d++);}catch(H){if(t===ft)throw H;r=[H,t,d,u[d]],A(ft,n,r,a,o,f,c),m(ft,o,r),C=!0}}else if(u||u===lt){if(o.isForm&&(o=o[ut]),v=o._p,u){if(x=[o._da||t===ft?r:r[0],v],f&&x.push(f),_t(1,u))return s(d=u.u)?d=d.apply(o,x):(s(F=u.p)&&(F=F.apply(o,x)),d=vt.makeURI(d,F)),vt.set(d,u.r,u.e),i;if(s(u)){if(w=u.apply(o,x),w===!1)return w;w===lt&&(u=lt),h(w)&&(d=w)}else d=h(u)?u:u.n,s(d)&&(w=d=d.apply(o,x));if(h(d)&&(x.unshift(d),w=U.apply(o,x),h(w)))for(d=e.createElement("div"),d.innerHTML=w,w=e.createDocumentFragment(),d=d.firstChild;d;)F=d[T],w.appendChild(d),d=F;if(w===!1)return w}if(!u||p(w)){if(E(B,0),y=$(o,u&&u.p,a),h(y)&&_(y),R=o._n,g=R[k=y._$Cid],j=g[0],!(k in c||u&&u.r===!1))for(d in R)d=R[d],c._&&d!==g||E(d,1);if(c[k]=c._=!0,u&&(b=j.parentNode))for(F=j.previousSibling,b.insertBefore(w,j),d=F?F[T]:b.firstChild;d!==j;d=d[T])g.push(d),d[W]=o}}return C}function E(e,t,n,r){for(;e.length>t;)r=e.pop(),(n=r.parentNode)&&n.removeChild(r)}function F(t,n,r){function a(e,t){if(e)for(e._w2||!e._r||(t=e[ut])&&t._r||e._r(),e=e.children,t=0;t<e.length;t++)a(e[t])}if(!(t._data instanceof F)){var o,f,u,l=t._data!==i&&!t[Z],h=this,p=h.datas=[],d=t[Y],_=0,g=t.render,v=function(e,r,o,f,u,s,d){if(e!==i&&(p[e]=r,_--),!_&&!h.rejected){if(s=t[Z],f=t.children,l||(t._data=p,t._r=function(e,r){t._r=i,e=$(t,t[st]),r=s?at:it,A(r,g,s||p,e,t,n)||(m(r,t,s||p),A(ot,g,s?[!0]:[],e,t,n)||m(ot,t))},t.isForm&&(c(t[ut],t,et),t._r())),t.wait)for(d=s?t._w2:1,o=t;o&&o._w2&&o._r;o=o[ut])o._w2-=d;if(a(L),!s)for(o=0;o<f.length;o++)u=f[o],u._id in K&&new F(u)}};if(!l){if(t._data=h,t._w2=t._w,e.title=(o=s(o=t.title)?o.call(t,t._p):o)===i?H:o,A(rt,g,[],$(t,t[st]),t,n))return;for(m(rt,t),u=function(e){_++,f.then(function(t){v(e,t)},function(n,r){(r=t[Z])||(r=t[Z]=new Array(p.length)),r[e]=n,v(e)})},o=0;o<d.length;o++)(f=d[o])&&(_t(2,f)?f=f.v:(s(f)||(f=new C(f,t,r),f.then||(f=f.d)),s(f)&&(f=f.call(t,t._p))),p.push(f),f&&s(f.then)&&u(o))}v()}}function R(e,t,n){var r,a,o,f;for(r=e.children,a=r.length;a--;)R(r[a],t);if(e._data&&s(e._data.reject)&&(e._data.reject(),e.isForm&&!e._c&&R(e[ut],t,!0),e._r=!0),e._r&&m("stop",e),e._r=e._f=i,e._data!==i&&(e._data=e[Z]=i,m("leave",e),!(e._id in t))){o=e._n,n=n?1:0;for(a in o)for(f=o[a];f.length>n;)B.push(f.pop());n||(e._n={})}}function T(e,t){var n,r,a,o,f,c,u,s=[],h=[];if(e instanceof HTMLFormElement)for(a=e.elements,n=0;n<a.length;n++){if(o=a[n],u=i,f=o.name)switch(o.type){case ct:case"reset":case"button":case"file":break;case"checkbox":case"radio":o.checked&&(u=o.value||"");break;case"select-multiple":for(c=o.options,u=[],r=0;r<c.length;r++)c[r].selected&&u.push(c[r].value);break;default:u=o.value||""}if(h.push([o,u]),!o.disabled&&u!==i)for(l(u)||(u=[u]),r=0;r<u.length;r++)s.push({name:f,value:u[r]})}return t?[s,h]:s}var H,N,D,U,I,S,L,q,M,O,K={},J=[],P=0,z={},B=[],G={before:{},success:{},error:{},after:{},stop:{},except:{},leave:{},busy:{},idle:{}},X=!1,Q=0,V=/[\x20\t\r\n\f]+/,W="_$Cf",Y="dataSource",Z="_dataError",et="valid",tt="invalid",nt="sending",rt="before",it="success",at="error",ot="after",ft="except",ct="submit",ut="parent",st="renderParent",lt=null,ht={d:lt},pt=y.prototype,dt=function(e){this.t=e},_t=function(e,t){return t instanceof dt&&t.t===e},mt=function(){},gt=function(e,t){var n=function(t){for(t in e)this[t]=e[t]};return n.prototype=t||new mt,new n},vt=function(e,t){return d(),h(e)&&h(t)?$H.on(e,t):e?u(e,t):M||(M=t),vt};return vt.add=vt,vt.set=function(e,t,n){return d(!0),q=t,$H.go(e,i,n)},vt.run=function(t){d();var n=e.body,f=n.addEventListener.bind(n);t=t||{},H=t.title||"",N=k(t.render),D=t[ut]||n,U=t.callTemplate||function(e,t,n,r,i,a){return(i=$C.tpl[e])||_("No `"+e+"` template"),a=[t,n,this],r&&a.push(r),i.apply(lt,a)},M&&u(i,M),$H.on(i,function(){var e,t,n,r,a={},f=0,c=0,u=function(e,t,n){return e._a?(e.wait&&e._w++,a[t=e._id]=e,f++,r||t in K||(r=!0),s(n=e.break)&&(n=n.call(e)),!!n):void 0},l=function(e){e._p instanceof mt||(e._p=gt(e._p,(e=e[ut])&&e._p))};for(t=0;t<J.length;t++)if(n=J[t],n._a){o(e=n,u,l);break}for(t in K)c++,n=K[t],t=t in a,(!t||q||!n._s||n.keep===!1||n[Z])&&R(n,a),t&&(n._s=1);!r&&c>f&&E(B,0),K=a,q=i,L=e,e&&new F(e)}),vt.on("before after stop",function(e){Q+=e===rt?1:-1,O&&clearTimeout(O),O=setTimeout(function(){e=X,X=!!Q,O=i,e!==X&&m(Q?"busy":"idle",vt)},0)}),f("click",function(e){for(var t=e.target;t&&!(t instanceof HTMLAnchorElement);)t=t.parentNode;!t||t.target||t.host!==r.host||e.altKey||e.ctrlKey||e.metaKey||e.shiftKey||1!==e.which||(e.preventDefault(),vt.set(t.href))},!1),f(ct,function(t){for(var n,o,f,u,l=t.target,h=l;l&&!(n=l[W]);)l=l.parentNode;n&&n.form&&(t.preventDefault(),n.checkForm(h)&&(o=h[W+"f"],K[o._id]=o,f=o._se,o[Y]=[s(u=h.getAttribute("action")||o.action)?u.call(h,f,n):u||r.href],o.method=h.getAttribute("method")||o._method||"get",new F(o,h,function(e,t,r,u){return t=o.type,e.setRequestHeader("Content-Type","text"===t?"text/plain":"json"===t?"application/json":"application/x-www-form-urlencoded"),h.cancel=function(){o._c=u=ht},f=(r=o[ct])?r.call(h,f,e,n):f,delete h.cancel,u||c(n,o,nt),u||("json"===t?JSON.stringify(f):f?"text"===t?f+"":a(f):i)}))),o||"get"!==h.method||h.target||(f=e.createElement("a"),f.href=h.action,f.host===r.host&&(t.preventDefault(),u=f.pathname+f.search,vt.set(("/"===u[0]?u:"/"+u)+(f.search?"&":"?")+a(T(h)))))}),I=!0,$H.run(),vt._debug={f:J,o:B}},vt.serializeForm=T,vt.makeURI=function(e,t){return x(i,e,t)},vt.on=function(e,t,n){var r,i,a="";if(h(e)&&s(t))if(e=e.split(V),1===e.length)(r=G[e])&&(n&&((a=z[n])&&(n=a),a=n._id),(i=r[a])||(i=r[a]=[]),i.push(t));else for(a=e.length;a--;)vt.on(e[a],t,n);return vt},vt.off=function(e,t,n){var r,i="";if(h(e)&&s(t))if(e=e.split(V),1===e.length){if(n&&((i=z[n])&&(n=i),i=n._id),(r=G[e])&&(r=r[i]))for(i=r.length;i--;)r[i]===t&&r.splice(i,1)}else for(i=e.length;i--;)vt.on(e[i],t,n);return vt},vt.get=function(e){return z[e]},vt.params=function(){return S},vt.URI=function(e,t,n,r){var i=new dt(1);return i.u=e,i.p=t,i.r=n,i.e=r,i},vt.DATA=function(e){var t=new dt(2);return t.v=e,t},vt.TEMPLATE=function(e,t,n){var r=new dt(3);return r.n=e,r.p=t,r.r=n,r},pt.reload=function(){var e,t=this;if(t._id in K){for(e=t[ut];e&&!(e._data instanceof F);)e=e[ut];e||(R(t,K,!0),new F(t))}},pt.params=function(e){var t=this;for(e=e||0;t&&e>0;)t=t[ut],e--;return t&&t._p||i},pt.data=function(e,t){var n,r=this;for(t=t||0;r&&t>0;)r=r[ut],t--;return n=r&&r._data,l(n)?-1===e?n:n[e||0]:i},pt.makeURI=function(e){return x(this,this.uri,e||{})},pt.active=function(e){return this._id in K&&(e?1===this._s:!0)},pt.checkForm=function(e){for(var t,n,r,a,o,c,u,s,l=e,h=this;l&&!(t=l[W]);)l=l.parentNode;if(h===t&&(l=h.form)){for((n=e[t=W+"f"])||(n=e[t]=new y(i,l,i,i,h,!0)),r=T(e,!0),a=n._fi=r[1],n._se=r=r[0],o=n.check,l=0;l<a.length;l++)c=a[l],u=o?o.call(h,c[0],c[1],r):i,f(h,n,c,u?(s=!0,tt):et,u);return!s}},$H.on({search:function(e,n,r,i,a,f){for(f=function(e){e._a=0},n=J.length;n--;)o(J[n],f);for(S={},e=e.split("&"),n=0;n<e.length;n++)(i=e[n])&&(~(a=i.indexOf("="))?(a=i.substring(a+1),i=t(i.substring(0,i.length-a.length-1)),a=t(a)):a=lt,(f=S[i])?(l(f)||(f=[f]),f.push(a)):f=a,S[i]=f)}},{}),pt=C.prototype,pt.then=function(e,t){var n=this;e&&n.ok.push(e),t&&n.err.push(t),n.done()},pt.reject=function(){var e=this;e.d||(e.r&&(e.r.abort(),e.r=i),e.d=e.e=!0,e.done())},pt.done=function(){var e,t,n=this;if(n.d)for(n.e?(e=n.err,t=n.r):(e=n.ok,t=n.j);e.length;)e.shift()(t)},F.prototype.reject=function(){var e,t,n=this.datas;for(this.rejected=!0,e=n.length;e--;)t=n[e],s(t.abort)&&t.abort(),s(t.reject)&&t.reject()},vt}(document,decodeURIComponent,encodeURIComponent,location);