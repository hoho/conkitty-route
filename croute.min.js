/*!
 * conkitty-route v0.5.1, https://github.com/hoho/conkitty-route
 * (c) 2014 Marat Abdullin, MIT license
 */
window.$CR=function(e,n,t,r,i,a,o){"use strict";function f(e,n,r,i){for(n=[],r=0;r<e.length;r++)i=e[r],n.push(t(i.name)+"="+t(i.value));return n.join("&")}function c(e,n,t,r,i,a,o,f){for(!r&&n&&n(e),a=e.children,i=0;i<a.length&&!(f=c(o=a[i],n,t));i++);return!r&&t&&t(e)}function u(e,n,t,r,i){var a=n.state,f=t[0],c=a?a.call(e,f,r,i):o,u=t[2];t[2]=r,c===o&&(r===tn&&u===an&&(f.disabled=!1),r===an&&(f.disabled?t[2]=u:f.disabled=!0))}function l(e,n,t){var r,i=n._fi;for(r=0;r<i.length;r++)u(e,n,i[r],t)}function s(e,n,t){t=new j(e,n),z.push(t)}function h(e){return"function"==typeof e}function p(e){return e instanceof Array}function d(e){return"string"==typeof e}function _(e){return e instanceof Node}function m(e){!!q!=!!e&&g("Running: "+!!q)}function g(e){throw new Error(e)}function v(e,n,t,r,i,a){if(r=X[e]){if(n=n.isForm?n[hn]:n,t=[e].concat(t||[]),(a=n._id)&&(i=r[a]))for(a=0;a<i.length;a++)i[a].apply(n,t);if(i=r[""])for(a=0;a<i.length;a++)i[a].apply(n,t)}}function w(e,n,t,r,i){return i="?"===e.charAt(1)?2:1,e=e.substring(i),e in n&&!t&&g("Duplicate param"),n[e]=i,e={param:e,optional:2===i},r&&r.push(e),r?"(?:/([^/]+))"+(2===i?"?":""):e}function b(e,t,r){var i,a,f,c,u,l,s,h={},p=[],d=[];for((e||"").replace(/^((?:(?:\:\?)|[^?#])*)(?:\?([^#]*))?(?:#(.*))?$/,function(e,n,t,r){i=(n||"").split("/"),a=(t||"").split("&"),f=r}),l=i.length,c=0;l>c;c++)((u=n(i[c]))||r&&c===l-1)&&p.push(":"===u.charAt(0)?w(u,h,t,t?o:d):t?u:"/"+u.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"));for(c=0;c<a.length;c++)(u=a[c])&&(s||(s={}),~(l=u.indexOf("="))?(l=u.substring(l+1),u=n(u.substring(0,u.length-l.length-1)),l=n(l)):l=dn,":"===u.charAt(0)&&g("Invalid queryparam"),u in s&&g("Duplicate queryparam"),s[u]=l&&":"===l.charAt(0)?w(l,h,t):{value:l});return f&&(f=":"===f.charAt(0)?w(f,h,t):{value:f}),{pathname:[p,d],search:s,hash:f,params:h}}function y(e,n,t,r,i,a,f,c){switch(t.param&&r&&(f=r[t.param]),!0){case"value"in t?t.value===n:n!==o&&!f:c=!0;break;case h(f):c=(n=f(n))!==o||t.optional;break;case n===o&&t.optional:c=!0;break;case f instanceof RegExp&&n!==o:c=f.test(n);break;case p(f):c=f.indexOf(n)>=0;break;case d(f):c=f===n;break;default:c=!1}return c&&n!==o&&(e!==o&&(i[e]=n),t&&t.param&&(a[t.param]=n)),c}function k(e,n){if(n=e._a)for(;e;)e._a-=n,e=e[hn]}function j(e,n,t,r,i,a){function f(e){e&&(vn(2,e)||vn(4,e)||d(e)||h(e))||g("Unexpected `"+e+"` as data source")}var c,u,l,s,_,m,v,w,C,E,R,T,$,A=this,F=/.*/,H={};if(A[hn]=i,A.children=[],A.uri=e,A._id="r"+ ++B,A._n={},n)if(A.title=n.title||i&&i.title,A[pn]=n[hn]||i&&i[pn],A.render=x(n.render),a)A.isForm=!0,(s=A.action=n.action)&&f(s),A._method=n.method,A.check=n.check,A.state=n.state,A.type=n.type,A[sn]=n[sn];else{R=n.params,(c=A.id=n.id)&&(c in G&&g("Duplicate id: "+c),G[c]=A),T=n.matcher,A.break=n.break,A.keep=n.keep,A.final=n.final,A.reduce=n.reduce,p(l=n.data)?A._da=!0:l=l!==o?[l]:[];for(c=0;c<l.length;c++)f(l[c]);if(A[en]=l,A.form=n.form,A.wait=((c=n.wait)===o?i&&i.wait:c)||!1,_=n.on)for(s in X)if(l=_[s])for(p(l)||(l=[l]),c=0;c<l.length;c++)yn.on(s,l[c],A);(c=n.refresh)&&(A.refresh=vn(5,c)?c:yn.REFRESH({refresh:c}))}if(e!==o&&(e=b(e),$=(t||[]).concat(e.pathname[0]),v=new RegExp($.join("")+"(?:/(.*))?"),w=e.pathname[1],C=e.search,E=e.hash,r||(r=1),F=function(e){H={};var n,t=e.match(v);if(t){for(n=w.length;n--;)if(!y(o,t[r+n],w[n],R,o,H)){n=!1;break}if(n===!1||!C&&!E&&T&&!T.call(A,H))return k(A),!1;if((A._d=!t[r+w.length])&&A.final!==!1)for(A._a=1,n=i;n;)n._a++,n=n[hn]}return A._a?H:!1},(C||E)&&(F={pathname:F},C&&(F.search=function(){var e,n={};for(e in C)if(!y(e,L[e],C[e],R,n,H)){n=!1;break}return(n===!1||!E&&T&&!T.call(A,H))&&(k(A),n=!1),n}),E&&(F.hash=function(e){var n=!y(o,e||o,E,R,o,H)||T&&!T.call(A,H)?!1:e||!0;return n||k(A),n})),u=n&&n.frames))for(l in u)m=new j(l,u[l],A.reduce===!1?t:$,r+(A.reduce===!1?0:w.length),A),A.children.push(m);$H.on(F,{go:function(n){e||(A._a=1),A._p=H,A._s=n},leave:function(){A._p=dn}})}function x(e){function n(e){return d(e)||h(e)||vn(1,e)||vn(3,e)||e===dn}e=n(e)||p(e)?{success:e}:e||{};var t,r,i,a,f,c,u,l={},s=[on,fn,cn,un,ln],_={"-":!1,"":o,"+":!0};for(t=s.length;t--;){r="",c=o;for(r in _)if(p(f=e[r+(a=s[t])])||f===o||(f=[f]),f){for(c||(c=[]),i=0;i<f.length;i++)n(u=f[i])||g("Unexpected `"+u+"` as a template"),c.push({s:_[r],v:u});l[a]=c}}return l}function C(e,n,t,r,i){return i=n.param,r=t&&i in t?t[i]:(r=e&&e._p)?r[i]:o}function E(e,n,r,i,a,f,c,u){var l,s,h,d,_;if(f||(i=[],a=[],f={}),!e||e&&e.reduce!==!1){for(n=b(n,!0,!r),h=n.pathname[0],l=h.length;l--;)d=h[l],_=d.param?C(e,d,r):d,_!==o&&i.unshift(t(_));if(h=n.search)for(l in h)if(!(l in f)){if(f[l]=!0,d=h[l],l=t(l),d.param){if(_=C(e,d,r),p(_)){for(s=0;s<_.length;s++)a.push(l+"="+t(_[s]));continue}}else _=d.value;_!==o&&a.push(l+"="+t(_))}!c&&(h=n.hash)&&(c=h.param?C(e,h,r):h.value)}return r&&e&&(l=e[hn])&&E(l,l.uri,r,i,a,f,c,!0),u?void 0:(i=("/"+i.join("/")).replace(/\/+/g,"/"),a.length&&(i+="?"+a.join("&")),c&&(i+="#"+t(c)),i)}function R(e,n,t,r,i,a,f,c,u,l,s){if(i=this,s=n.method,n=n.isForm?n[hn]:n,vn(4,e)&&(e=e.v)){if((f=e.override)&&(f=f.call(n,n._p))!==o)return{d:f};a=e.parse,c=e.transform,e=e.uri,h(e)&&(e=e.call(n,n._p),l=!0)}return i.ok=[],i.err=[],i.r=r=new XMLHttpRequest,r.open(s||"GET",r.uri=l?e:E(n,e),!0),r.onreadystatechange=function(){if(4===r.readyState){if(i.d=i.e=!0,200===r.status)try{u=r.responseText,u=a?a.call(n,u,r):JSON.parse(u),i.j=c?c.call(n,u,r):u,i.e=!1}catch(e){}i.done(),i.r=o}},t&&(t=t(r)),t===_n?t:void r.send(t)}function T(n,t,r,i,a,f){return i=t,n=n.isForm?n[hn]:n,d(r)&&(r=o),t=t||r||D,t&&!_(t)&&(t=h(t)?t.call(n):e.querySelector(t)),_(t)?((a=t._$Cid)||(t._$Cid=a=++B),f=n._n,f[a]||(f[a]=[r=e.createComment("")],t.appendChild(r))):t="No node `"+i+"`"+((i=n.id)?" ("+i+")":""),t}function $(n,t,r,i,a,f,c,u){var l,s,m,w,b,y,k,j,x,C,R,F="nextSibling";if(u=u===o?t[n]||I[n]||[]:u.s===o||u.s===a.active(!0)?u.v:o,p(u)){if(n===ln&&!u.length)throw r[0];try{for(c={},l=0;l<u.length&&$(n,t,r,i,a,f,c,u[l])!==!1;l++);}catch(H){if(n===ln)throw H;r=[H,n,l,u[l]],$(ln,t,r,i,a,f,c),v(ln,a,r),x=!0}}else if(u||u===dn){if(a.isForm&&(a=a[hn]),j=[a._da||n===ln?r:r[0],a._p],f&&j.push(f),vn(1,u))h(l=u.u)?l=l.apply(a,j):(h(C=u.p)&&(C=C.apply(a,j)),l=E(o,l,C)),yn.set(l,u.r,u.e);else if(u){if(h(u)){if(m=u.apply(a,j),m===!1)return m;m===dn&&(u=dn),d(m)&&(l=m)}else l=d(u)?u:u.n,h(l)&&(m=l=l.apply(a,j));if(d(l)&&(j.unshift(l),m=U.apply(a,j),d(m)))for(l=e.createElement("div"),l.innerHTML=m,m=e.createDocumentFragment(),l=l.firstChild;l;)C=l[F],m.appendChild(l),l=C;if(m===!1)return m}if(!u||_(m)){if(A(W,0),b=T(a,u&&u.p,i),d(b)&&g(b),R=a._n,s=R[y=b._$Cid],k=s[0],!(y in c||u&&u.r===!1))for(l in R)l=R[l],c._&&l!==s||A(l,1);if(c[y]=c._=!0,u&&(w=k.parentNode))for(C=k.previousSibling,w.insertBefore(m,k),l=C?C[F]:w.firstChild;l!==k;l=l[F])s.push(l),l[Z]=a}}return x}function A(e,n,t,r){for(;e.length>n;)r=e.pop(),(t=r.parentNode)&&t.removeChild(r)}function F(n,t,r,f){function u(e,n,t,r){if(e){if(t)for(r=n;r&&r._w2;r=r[hn])r._w2-=t;e._w2||!e._r||(r=e[hn])&&r._r||e._r(),c(e,u,o,!0)}}if(!n._l){var s,p,d,_=!t&&(n._data!==o||n._l)&&!n[nn],m=this,g=m.datas=[],w=n[en],b=0,y=n.render,k=function(e,f,c,s,d,k,j,x){if(e!==o&&(g[e]=f,b--),!b&&!m.rejected){if(k=n[nn],s=n.children,!_){if(t&&k&&(n[nn]=o),n._l=o,j=n._data,n._data=g,x=k?t?dn:cn:fn,x&&t&&2!==t){for(d=!0,c=g.length;d&&c--;)p=w[c],d=d&&(vn(4,p)&&p.v.eq||$H.eq).call(n,g[c],j[c]);d?x=dn:t=2}n._r=function(e){if(n._r=o,e=T(n,n[pn]),x){if($(x,y,k||g,e,n,r))return;if(!t){if(v(x,n,k||g),$(un,y,k?[!0]:[],e,n,r))return;v(un,n)}}!(c=n.refresh)||!j&&k||!function f(e,t,r){n._u&&a(n._u),n._o&&(a(n._o),n._o=dn),r=h(r=e.r)?r.call(n):r,t&&!e.j&&(r-=t),n._u=i(function(){n._u=dn,(t=e.o||0)&&(t=h(t)?t.call(n):t,n._o=i(function(){n._o=dn,n._l.reject(),n._l=o,f(e,t)},t)),new F(n,1)},0>r?0:r)}(c)},n.isForm&&(l(n[hn],n,tn),n._r())}if(u(M,n,k||!n.wait&&!t?n._w2:1),!k)for(c=0;c<s.length;c++)d=s[c],d._id in P&&new F(d,t)}};if(!_){if(n._l=m,m.u=t,n._w2=p=n._w,n.wait||t||u(M,n,p),e.title=(s=h(s=n.title)?s.call(n,n._p):s)===o?S:s,!t){if($(on,y,[],T(n,n[pn]),n,r))return;v(on,n)}for(d=function(e){b++,p.then(function(n){k(e,n)},function(t,r){(r=n[nn])||(r=n[nn]=new Array(g.length)),r[e]=t,k(e)})},s=0;s<w.length;s++)(p=w[s])&&(vn(2,p)?p=p.v:(h(p)||(p=new R(p,n,f),p.then||(p=p.d)),h(p)&&(p=p.call(n,n._p))),g.push(p),p&&h(p.then)&&d(s))}k()}}function H(e,n,t){var r,i,f;if(c(e,function(e){H(e,n)},o,!0),e._l&&(e._r=!e._l.u,e._l.reject(),e.isForm&&!e._c&&H(e[hn],n,!0)),(r=e._u)&&(a(r),e._u=o),(r=e._o)&&(a(r),e._o=o),e._r&&v("stop",e),e._r=e._f=o,!(e._l===o&&e._data===o||(e._l=e._data=e[nn]=o,e._id in n))){v("leave",e),i=e._n,t=t?1:0;for(r in i)for(f=i[r];f.length>t;)W.push(f.pop());t||(e._n={})}}function N(e,n){var t,r,i,a,f,c,u,l=[],s=[];if(e instanceof HTMLFormElement)for(i=e.elements,t=0;t<i.length;t++){if(a=i[t],u=o,f=a.name)switch(a.type){case sn:case"reset":case"button":case"file":break;case"checkbox":case"radio":a.checked&&(u=a.value||"");break;case"select-multiple":for(c=a.options,u=[],r=0;r<c.length;r++)c[r].selected&&u.push(c[r].value);break;default:u=a.value||""}if(s.push([a,u]),!a.disabled&&u!==o)for(p(u)||(u=[u]),r=0;r<u.length;r++)l.push({name:f,value:u[r]})}return n?[l,s]:l}var S,I,D,U,q,L,M,O,K,J,P={},z=[],B=0,G={},W=[],X={before:{},success:{},error:{},after:{},stop:{},except:{},leave:{},busy:{},idle:{}},Q=!1,V=0,Y=/[\x20\t\r\n\f]+/,Z="_$Cf",en="dataSource",nn="_dataError",tn="valid",rn="invalid",an="sending",on="before",fn="success",cn="error",un="after",ln="except",sn="submit",hn="parent",pn="renderParent",dn=null,_n={d:dn},mn=j.prototype,gn=function(e){this.t=e},vn=function(e,n){return n instanceof gn&&n.t===e},wn=function(){},bn=function(e,n){var t=function(n){for(n in e)this[n]=e[n]};return t.prototype=n||new wn,new t},yn=function(e,n){return m(),d(e)&&d(n)?$H.on(e,n):e?s(e,n):K||(K=n),yn};return yn.add=yn,yn.set=function(e,n,t){return m(!0),O=n,$H.go(e,o,t)},yn.run=function(n){m();var t=e.body,u=t.addEventListener.bind(t);n=n||{},S=n.title||"",I=x(n.render),D=n[hn]||t,U=n.callTemplate||function(e,n,t,r,i,a){return(i=$C.tpl[e])||g("No `"+e+"` template"),a=[n,t,this],r&&a.push(r),i.apply(dn,a)},K&&s(o,K),$H.on(o,function(){var e,n,t,r,i={},a=0,f=0,u=function(e){e._w=0,e._p instanceof wn||(e._p=bn(e._p,(e=e[hn])&&e._p))},l=function(e,n,t){return e._a?(e._w++,i[n=e._id]=e,a++,r||n in P||(r=!0),h(t=e.break)&&(t=t.call(e)),(n=e[hn])&&(n._w+=e._w),!!t):void 0};for(n=0;n<z.length;n++)if(t=z[n],t._a){c(e=t,u,l);break}for(n in P)f++,t=P[n],n=n in i,(!n||O||!t._s||t.keep===!1||t[nn])&&H(t,i),n&&(t._s=1);!r&&f>a&&A(W,0),P=i,O=o,M=e,e&&new F(e)}),yn.on("before after stop",function(e){V+=e===on?1:-1,J&&a(J),J=i(function(){e=Q,Q=!!V,J=o,e!==Q&&v(V?"busy":"idle",yn)},0)}),u("click",function(e){for(var n=e.target;n&&!(n instanceof HTMLAnchorElement);)n=n.parentNode;!n||n.target||n.host!==r.host||e.altKey||e.ctrlKey||e.metaKey||e.shiftKey||1!==e.which||(e.preventDefault(),yn.set(n.href))},!1),u(sn,function(n){for(var t,i,a,c,u=n.target,s=u;u&&!(t=u[Z]);)u=u.parentNode;t&&t.form&&(n.preventDefault(),t.checkForm(s)&&(i=s[Z+"f"],P[i._id]=i,a=i._se,i[en]=[h(c=s.getAttribute("action")||i.action)?yn.STATIC(c.call(s,a,t)):c||r.href],i.method=s.getAttribute("method")||i._method||"get",new F(i,o,s,function(e,n,r,c){return n=i.type,e.setRequestHeader("Content-Type","text"===n?"text/plain":"json"===n?"application/json":"application/x-www-form-urlencoded"),s.cancel=function(){i._c=c=_n},a=(r=i[sn])?r.call(s,a,e,t):a,delete s.cancel,c||l(t,i,an),c||("json"===n?JSON.stringify(a):a?"text"===n?a+"":f(a):o)}))),i||"get"!==s.method||s.target||(a=e.createElement("a"),a.href=s.action,a.host===r.host&&(n.preventDefault(),c=a.pathname+a.search,yn.set(("/"===c[0]?c:"/"+c)+(a.search?"&":"?")+f(N(s)))))}),q=!0,$H.run(),yn._debug={f:z,o:W}},yn.serializeForm=N,yn.makeURI=function(e,n){return E(o,e,n)},yn.on=function(e,n,t){var r,i,a="";if(d(e)&&h(n))if(e=e.split(Y),1===e.length)(r=X[e])&&(t&&((a=G[t])&&(t=a),a=t._id),(i=r[a])||(i=r[a]=[]),i.push(n));else for(a=e.length;a--;)yn.on(e[a],n,t);return yn},yn.off=function(e,n,t){var r,i="";if(d(e)&&h(n))if(e=e.split(Y),1===e.length){if(t&&((i=G[t])&&(t=i),i=t._id),(r=X[e])&&(r=r[i]))for(i=r.length;i--;)r[i]===n&&r.splice(i,1)}else for(i=e.length;i--;)yn.on(e[i],n,t);return yn},yn.get=function(e){return G[e]},yn.params=function(){return L},yn.URI=function(e,n,t,r){var i=new gn(1);return i.u=e,i.p=n,i.r=t,i.e=r,i},yn.STATIC=function(e){var n=new gn(2);return n.v=e,n},yn.TEMPLATE=function(e,n,t){var r=new gn(3);return r.n=e,r.p=n,r.r=t,r},yn.DATA=function(e){var n=new gn(4);return e&&e.uri||g("No URI"),n.v=e,n},yn.REFRESH=function(e){var n,t=new gn(5);return h(n=t.r=e.refresh)||"number"==typeof n||g("Wrong refresh"),t.o=e.timeout,t.j=(n=e.join)===o?!0:n,t},mn.reload=function(){var e,n=this;if(n._id in P){for(e=n[hn];e&&!e._l;)e=e[hn];e||(H(n,P,!0),new F(n))}},mn.params=function(e){var n=this;for(e=e||0;n&&e>0;)n=n[hn],e--;return n&&n._p||o},mn.data=function(e,n){var t,r=this;for(n=n||0;r&&n>0;)r=r[hn],n--;return t=r&&r._data,p(t)?-1===e?t:t[e||0]:o},mn.makeURI=function(e){return E(this,this.uri,e||{})},mn.active=function(e){return this._id in P&&(e?1===this._s:!0)},mn.checkForm=function(e){for(var n,t,r,i,a,f,c,l,s=e,h=this;s&&!(n=s[Z]);)s=s.parentNode;if(h===n&&(s=h.form)){for((t=e[n=Z+"f"])||(t=e[n]=new j(o,s,o,o,h,!0)),r=N(e,!0),i=t._fi=r[1],t._se=r=r[0],a=t.check,s=0;s<i.length;s++)f=i[s],c=a?a.call(h,f[0],f[1],r):o,u(h,t,f,c?(l=!0,rn):tn,c);return!l}},$H.on({search:function(e,t,r,i,a,f){for(f=function(e){e._a=0},t=z.length;t--;)c(z[t],o,f);for(L={},e=e.split("&"),t=0;t<e.length;t++)(i=e[t])&&(~(a=i.indexOf("="))?(a=i.substring(a+1),i=n(i.substring(0,i.length-a.length-1)),a=n(a)):a=dn,(f=L[i])?(p(f)||(f=[f]),f.push(a)):f=a,L[i]=f)}},{}),mn=R.prototype,mn.then=function(e,n){var t=this;e&&t.ok.push(e),n&&t.err.push(n),t.done()},mn.reject=function(){var e=this;e.d||(e.r&&(e.r.abort(),e.r=o),e.d=e.e=!0,e.done())},mn.done=function(){var e,n,t=this;if(t.d)for(t.e?(e=t.err,n=t.r):(e=t.ok,n=t.j);e.length;)e.shift()(n)},F.prototype.reject=function(){var e,n,t=this.datas;for(this.rejected=!0,e=t.length;e--;)n=t[e],h(n.abort)&&n.abort(),h(n.reject)&&n.reject()},yn}(document,decodeURIComponent,encodeURIComponent,location,setTimeout,clearTimeout);