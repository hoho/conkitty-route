/*!
 * conkitty-route v0.6.4, https://github.com/hoho/conkitty-route
 * (c) 2014 Marat Abdullin, MIT license
 */
window.$CR=function(e,n,t,r,i,a,o){"use strict";function f(e,n,r,i){for(n=[],r=0;r<e.length;r++)i=e[r],n.push(t(i.name)+"="+t(i.value));return n.join("&")}function u(e,n,t,r,i,a,o,f){for(!r&&n&&n(e),a=e.children,i=0;i<a.length&&!(f=u(o=a[i],n,t));i++);return!r&&t&&t(e)}function c(e,n,t,r,i){var a=n.state,f=t[0],u=a?a.call(e,f,r,i):o,c=t[2];t[2]=r,u===o&&(r===an&&c===fn&&(f.disabled=!1),r===fn&&(f.disabled?t[2]=c:f.disabled=!0))}function s(e,n,t){var r,i=n._fi;for(r=0;r<i.length;r++)c(e,n,i[r],t)}function l(e,n){new x(P,o,e,n)}function h(e){return"function"==typeof e}function p(e){return e instanceof Array}function d(e){return"string"==typeof e}function _(e){return e instanceof Node}function g(e){!!L!=!!e&&m("Running: "+!!L)}function m(e){throw new Error(e)}function v(e,n,t,r,i,a){if(r=V[e]){if(n=n.isForm?n[dn]:n,t=[e].concat(t||[]),(a=n._id)&&(i=r[a]))for(a=0;a<i.length;a++)i[a].apply(n,t);if(i=r[""])for(a=0;a<i.length;a++)i[a].apply(n,t)}}function w(e,n,t,r,i){return i="?"===e.charAt(1)?2:1,e=e.substring(i),e in n&&!t&&m("Duplicate param"),n[e]=i,e={param:e,optional:2===i},r&&r.push(e),r?"(?:/([^/]+))"+(2===i?"?":""):e}function b(e,t,r){var i,a,f,u,c,s,l,h={},p=[],d=[];for((e||"").replace(/^((?:(?:\:\?)|[^?#])*)(?:\?([^#]*))?(?:#(.*))?$/,function(e,n,t,r){i=(n||"").split("/"),a=(t||"").split("&"),f=r}),s=i.length,u=0;s>u;u++)((c=n(i[u]))||r&&u===s-1)&&p.push(":"===c.charAt(0)?w(c,h,t,t?o:d):t?c:"/"+c.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"));for(u=0;u<a.length;u++)(c=a[u])&&(l||(l={}),~(s=c.indexOf("="))?(s=c.substring(s+1),c=n(c.substring(0,c.length-s.length-1)),s=n(s)):s=gn,":"===c.charAt(0)&&m("Invalid queryparam"),c in l&&m("Duplicate queryparam"),l[c]=s&&":"===s.charAt(0)?w(s,h,t):{value:s});return f&&(f=":"===f.charAt(0)?w(f,h,t):{value:f}),{pathname:[p,d],search:l,hash:f,params:h}}function y(e,n,t,r,i,a,f,u){switch(t.param&&r&&(f=r[t.param]),!0){case"value"in t?t.value===n:n!==o&&!f:u=!0;break;case h(f):u=(n=f(n))!==o||t.optional;break;case n===o&&t.optional:u=!0;break;case f instanceof RegExp&&n!==o:u=f.test(n);break;case p(f):u=f.indexOf(n)>=0;break;case d(f):u=f===n;break;default:u=!1}return u&&n!==o&&(e!==o&&(i[e]=n),t&&t.param&&(a[t.param]=n)),u}function k(e,n,t){if(!!(t=e._a)==!n)for(;e;)e._a+=n||-t,e=e[dn]}function x(e,n,t,r,i,a,f,u){function c(e){e&&(wn(2,e)||wn(4,e)||d(e)||h(e))||m("Unexpected `"+e+"` as data source")}var s,l,_,g,v,w,C,$,F,H,N,R,q=this,A=/.*/,E={};if(q[dn]=f,q.children=[],q.uri=t,q._id="r"+ ++W,q._n={},r){if(q.title=r.title||f&&f.title,q[_n]=r[dn]||f&&f[_n],q.render=j(r.render),u)q.isForm=!0,(g=q.action=r.action)&&c(g),q._method=r.method,q.check=r.check,q.state=r.state,q.type=r.type,q[pn]=r[pn],q.xhr=r.xhr;else{e.push(q),n&&(q._g=n,n.push(q)),H=r.params,(s=q.id=r.id)&&(s in X&&m("Duplicate id: "+s),X[s]=q),N=r.matcher,q.break=r.break,q.keep=r.keep,q.final=r.final,q.reduce=r.reduce,p(_=r.data)?q._da=!0:_=_!==o?[_]:[];for(s=0;s<_.length;s++)c(_[s]);if(q[tn]=_,q.form=r.form,q.wait=((s=r.wait)===o?f&&f.wait:s)||!1,v=r.on)for(g in V)if(_=v[g])for(p(_)||(_=[_]),s=0;s<_.length;s++)kn.on(g,_[s],q)}(s=g=r.refresh)&&(s=wn(5,s)?s:kn.$.refresh({refresh:s}),u?q.tags=Object.keys(s.t).join(" "):q.refresh=s)}if(t!==o&&(t=b(t),R=(i||[]).concat(t.pathname[0]),w=new RegExp(R.join("")+"(?:/(.*))?"),C=t.pathname[1],$=t.search,F=t.hash,a||(a=1),A=function(e){E={};var n,t=e.match(w);if(t){for(n=C.length;n--;)if(!y(o,t[a+n],C[n],H,o,E)){n=!1;break}if(n===!1||!$&&!F&&N&&!N.call(q,E))return k(q),!1;(q._d=!t[a+C.length])&&q.final!==!1&&k(q,1)}return q._a?E:!1},($||F)&&(A={pathname:A},$&&(A.search=function(){var e,n={};for(e in $)if(!y(e,K[e],$[e],H,n,E)){n=!1;break}return(n===!1||!F&&N&&!N.call(q,E))&&(k(q),n=!1),n}),F&&(A.hash=function(e){var n=!y(o,e||o,F,H,o,E)||N&&!N.call(q,E)?!1:e||!0;return n||k(q),n})),l=r&&r.frames))for(_ in l)for(p(g=l[_])?n=[]:(g=[g],n=o),s=0;s<g.length;s++)new x(q.children,n,_,g[s],q.reduce===!1?i:R,a+(q.reduce===!1?0:C.length),q);$H.on(A,{go:function(e){t||(q._a=1),q._p=E,q._s=e},leave:function(){q._p=gn}})}function j(e,n){function t(e){return d(e)||h(e)||wn(1,e)||wn(3,e)||e===gn}e=t(e)||p(e)?{success:e}:e||{},n&&(e[cn]===o&&(e[cn]=gn),e[sn]===o&&(e[sn]=gn));var r,i,a,f,u,c,s,l={},_=[un,cn,sn,ln,hn],g={"-":!1,"":o,"+":!0};for(r=_.length;r--;){i="",c=o;for(i in g)if(p(u=e[i+(f=_[r])])||u===o||(u=[u]),u){for(c||(c=[]),a=0;a<u.length;a++)t(s=u[a])||m("Unexpected `"+s+"` as a template"),c.push({s:g[i],v:s});l[f]=c}}return l}function C(e,n,t,r,i){return i=n.param,r=t&&i in t?t[i]:(r=e&&e._p)?r[i]:o}function $(e,n,r,i,a,f,u,c){var s,l,h,d,_;if(f||(i=[],a=[],f={}),!e||e&&e.reduce!==!1){for(n=b(n,!0,!r),h=n.pathname[0],s=h.length;s--;)d=h[s],_=d.param?C(e,d,r):d,_!==o&&i.unshift(t(_));if(h=n.search)for(s in h)if(!(s in f)){if(f[s]=!0,d=h[s],s=t(s),d.param){if(_=C(e,d,r),p(_)){for(l=0;l<_.length;l++)a.push(s+"="+t(_[l]));continue}}else _=d.value;_!==o&&a.push(s+"="+t(_))}!u&&(h=n.hash)&&(u=h.param?C(e,h,r):h.value)}return r&&e&&(s=e[dn])&&$(s,s.uri,r,i,a,f,u,!0),c?void 0:(i=("/"+i.join("/")).replace(/\/+/g,"/"),a.length&&(i+="?"+a.join("&")),u&&(i+="#"+t(u)),i)}function F(e,n,t,r,i,a,f,u,c,s,l){if(i=this,l=n.method,n=n.isForm?n[dn]:n,wn(4,e)&&(e=e.v)){if((f=e.override)&&(f=f.call(n,n._p))!==o)return{o:f};l=e.method||l,a=e.parse,u=e.transform,e=e.uri,h(e)&&(e=e.call(n,n._p),s=!0)}h(l)&&(l=l.call(n,n._p)),i.ok=[],i.err=[],i.r=r=new XMLHttpRequest,r.open(r.method=(l||"GET").toUpperCase(),r.uri=s?e:$(n,e),!0),v("xhr",n,[r,!1]),r.onreadystatechange=function(){if(4===r.readyState){if(v("xhr",n,[r,!0]),i.d=i.e=!0,2===(r.status/100|0))try{c=r.responseText,c=a?a.call(n,c,r):204===r.status?o:JSON.parse(c),i.j=u?u.call(n,c,r):c,i.e=!1}catch(e){}i.done(),i.r=o}},t&&(t=t(r)),r.send(t)}function H(n,t,r,i,a,f){return i=t,n=n.isForm?n[dn]:n,d(r)&&(r=o),t=t||r||S,t&&!_(t)&&(t=h(t)?t.call(n):e.querySelector(t)),_(t)?((a=t._$Cid)||(t._$Cid=a=++W),f=n._n,f[a]||(f[a]=[r=e.createComment("")],t.appendChild(r))):t="No node `"+i+"`"+((i=n.id)?" ("+i+")":""),t}function N(n,t,r,i,a,f,u,c){var s,l,g,w,b,y,k,x,j,C,F,q="nextSibling";if(c=c===o?t[n]||D[n]||[]:c.s===o||c.s===a.active(!0)?c.v:o,p(c)){if(n===hn&&!c.length)throw r[0];try{for(u={},s=0;s<c.length&&N(n,t,r,i,a,f,u,c[s])!==!1;s++);}catch(A){if(n===hn)throw A;r=[A,n,s,c[s]],N(hn,t,r,i,a,f,u),v(hn,a,r),j=!0}}else if(c||c===gn){if(a.isForm&&(a=a[dn]),x=[a._da||n===hn?r:r[0],a._p],f&&x.push(f),h(c)&&(c=c.apply(a,x),c===!1))return c;if(wn(1,c))h(s=c.u)?s=s.apply(a,x):(h(C=c.p)&&(C=C.apply(a,x)),s=$(o,s,yn(C,a._p))),kn.set(s,c.r,c.e);else if(c){if(_(c)&&(g=c),s=d(c)?c:c.n,h(s)&&(g=s=s.apply(a,x)),d(s)&&(x.unshift(s),g=I.apply(a,x),d(g)))for(s=e.createElement("div"),s.innerHTML=g,g=e.createDocumentFragment(),s=s.firstChild;s;)C=s[q],g.appendChild(s),s=C;if(g===!1)return g}if(!c||_(g)){if(R(Q,0),b=H(a,c&&c.p,i),d(b)&&m(b),F=a._n,l=F[y=b._$Cid],k=l[0],!(y in u||c&&c.r===!1))for(s in F)s=F[s],u._&&s!==l||R(s,1);if(u[y]=u._=!0,c&&(w=k.parentNode))for(C=k.previousSibling,w.insertBefore(g,k),s=C?C[q]:w.firstChild;s!==k;s=s[q])l.push(s),s[nn]=a}}return j}function R(e,n,t,r){for(;e.length>n;)r=e.pop(),(t=r.parentNode)&&t.removeChild(r)}function q(n,t,r,i){function a(e,n,t,r){if(e){if(t)for(r=n;r&&r._w2;r=r[dn])r._w2-=t;e._w2||!e._r||(r=e[dn])&&r._r||e._r(),u(e,a,o,!0)}}if(n._l){if(!n._l.u)return;E(n)}var f,c,l,p=!t&&(n._data!==o||n._l)&&!n[rn],d=this,_=d.datas=[],g=n[tn],m=0,w=n.render,b=function(e,i,f,u,l,h,b,y){if(e!==o&&(_[e]=i,m--),!m&&!d.rejected){if(h=n[rn],u=n.children,!p){if(t&&h&&(n[rn]=o),n._l=o,b=n._data,n._data=_,y=h?t?gn:sn:cn,y&&1===t){for(l=!0,f=_.length;l&&f--;)c=g[f],l=l&&(wn(4,c)&&c.v.eq||$H.eq).call(n,_[f],b[f]);l?y=gn:t=2}n._r=function(e){if(n._r=o,e=H(n,n[_n]),y){if(N(y,w,h||_,e,n,r))return;if(!t){if(n.isForm&&y===cn&&n.tags&&kn.refresh(n.tags),v(y,n,h||_),N(ln,w,h?[!0]:[],e,n,r))return;v(ln,n)}}!(f=n.refresh)||f.r===o||!b&&h||T(n,f.r,f)},n.isForm&&(s(n[dn],n,an),n._r())}for(a(M,n,h||!n.wait&&!t?n._w2:1),f=0;f<u.length;f++)l=u[f],l._id in G&&(h?(A(l,{}),R(Q,0)):new q(l,t))}};if(!p){if(n._l=d,d.u=t,n._w2=c=n._w,n.wait||t||a(M,n,c),f=(f=h(f=n.title)?f.call(n,n._p):f)===o?U:f,f!==o&&(e.title=f),!t){if(N(un,w,[],H(n,n[_n]),n,r))return;v(un,n)}for(l=function(e){m++,c.then(function(n){b(e,n)},function(t,r){(r=n[rn])||(r=n[rn]=new Array(_.length)),r[e]=t,b(e)})},f=0;f<g.length;f++)(c=g[f])&&(wn(2,c)?c=c.v:h(c)?c=c.call(n,n._p):(c=new F(c,n,i),"o"in c&&(c=c.o)),_.push(c),c&&h(c.then)&&l(f))}b()}function A(e,n,t){var r,i,a;if(u(e,function(e){A(e,n)},o,!0),(r=e._l)&&(e._r=!r.u,e.isForm&&!e._c&&A(e[dn],n,!0)),E(e),e._r&&v("stop",e),e._r=e._f=o,!(r===o&&e._data===o&&!Object.keys(e._n).length||(e._l=e._data=e[rn]=o,e._id in n))){v("leave",e),i=e._n,t=t?1:0;for(r in i)for(a=i[r];a.length>t;)Q.push(a.pop());t||(e._n={})}}function E(e,n){(n=e._u)&&(a(n),e._u=o),(n=e._o)&&(a(n),e._o=o),(n=e._l)&&(n.reject(),e._l=o)}function T(e,n,t,r,a,f){h(n)&&(n=n.call(e)),n!==o&&(!(f=e._l)||f.u&&r)&&(E(e),a&&!t.j&&(n-=a),e._u=i(function(){e._u=gn,E(e),(a=t.o||0)&&(a=h(a)?a.call(e):a,e._o=i(function(){e._o=gn,T(e,t.r,t,!1,a)},a)),new q(e,1)},0>n?0:n))}function O(e,n){var t,r,i,a,f,u,c,s=[],l=[];if(e instanceof HTMLFormElement)for(i=e.elements,t=0;t<i.length;t++){if(a=i[t],c=o,f=a.name)switch(a.type){case pn:case"reset":case"button":case"file":break;case"checkbox":case"radio":a.checked&&(c=a.value||"");break;case"select-multiple":for(u=a.options,c=[],r=0;r<u.length;r++)u[r].selected&&c.push(u[r].value);break;default:c=a.value||""}if(l.push([a,c]),!a.disabled&&c!==o)for(p(c)||(c=[c]),r=0;r<c.length;r++)s.push({name:f,value:c[r]})}return n?[s,l]:s}var U,D,S,I,L,K,M,J,z,B,G={},P=[],W=0,X={},Q=[],V={before:{},success:{},error:{},after:{},stop:{},except:{},leave:{},busy:{},idle:{},xhr:{}},Y=!1,Z=0,en=/[\x20\t\r\n\f]+/,nn="_$Cf",tn="dataSource",rn="_dataError",an="valid",on="invalid",fn="sending",un="before",cn="success",sn="error",ln="after",hn="except",pn="submit",dn="parent",_n="renderParent",gn=null,mn=x.prototype,vn=function(e){this._=e},wn=function(e,n){return n instanceof vn&&n._===e},bn=function(){},yn=function(e,n){var t=function(n){for(n in e)this[n]=e[n]};return t.prototype=n||new bn,new t},kn=function(e,n){return g(),d(e)&&d(n)?l(e,{render:function(e,t){kn.set($(o,n,t),o,!0)}}):e?l(e,n):z||(z=n),kn};return kn.add=kn,kn.set=function(e,n,t){return g(!0),J=n,$H.go(e,o,t)},kn.run=function(n){g();var t=e.body,c=t.addEventListener.bind(t);n=n||{},U=n.title,D=j(n.render,1),S=n[dn]||t,I=n.callTemplate||function(e,n,t,r,i,a){return(i=$C.tpl[e])||m("No `"+e+"` template"),a=[n,t,this],r&&a.push(r),i.apply(gn,a)},z&&l(o,z),$H.on(o,function(){var e,n,t,r,i={},a=0,f=0,c=function(e){e._w=0,e._p instanceof bn||(e._p=yn(e._p,(e=e[dn])&&e._p))},s=function(e,n,t){return e._a?(e._w++,i[n=e._id]=e,a++,r||n in G||(r=!0),h(t=e.break)&&(t=t.call(e)),(n=e[dn])&&(n._w+=e._w),!!t):void 0},l=function(e,n,t,r){if(n=e._g)for(t=n.length;t--;)if((r=n[t])._a){for(r=r._s,t=n.length;t--;)(e=n[t])._a||e.final===!1||k(e,1),e._s=r;break}};for(n=0;n<P.length;n++)if(t=P[n],t._a){u(e=t,o,l),u(t,c,s);break}for(n in G)f++,t=G[n],n=n in i,(!n||J||!t._s||t.keep===!1||t[rn])&&A(t,i),n&&(t._s=1);!r&&f>a&&R(Q,0),G=i,J=o,M=e,e&&new q(e)}),kn.on("before after stop",function(e){Z+=e===un?1:-1,B&&a(B),B=i(function(){e=Y,Y=!!Z,B=o,e!==Y&&v(Z?"busy":"idle",kn)},0)}),c("click",function(e){for(var n=e.target;n&&!(n instanceof HTMLAnchorElement);)n=n.parentNode;!n||n.target||n.host!==r.host||e.altKey||e.ctrlKey||e.metaKey||e.shiftKey||1!==e.which||(e.preventDefault(),kn.set(n.href))},!1),c(pn,function(n){function t(e){c=h(c=g.getAttribute("action")||a.action)?c.call(g,e,i):c||r.href,l=a.type||"qs","get"===a.method&&"qs"===l&&(e.length&&(c+=(~c.indexOf("?")?"&":"?")+f(e)),e=o),"qs"!==l||e&&e.length||(e=l=o),a[tn]=[c],new q(a,o,g,function(n,t){return(e!==o||l!==o)&&n.setRequestHeader("Content-Type","text"===l?"text/plain":"json"===l?"application/json":"application/x-www-form-urlencoded"),(t=a.xhr)&&t.call(g,n,e,i),s(i,a,fn),"json"===l?JSON.stringify(e):e?"text"===l?e+"":f(e||[]):o})}for(var i,a,u,c,l,p,d,_=n.target,g=_;_&&!(i=_[nn]);)_=_.parentNode;i&&i.form&&(n.preventDefault(),i.checkForm(g)&&(a=g[nn+"f"],G[a._id]=a,u=a._se,a.method=(g.getAttribute("method")||a._method||"get").toLowerCase(),u=(p=a[pn])?p.call(g,u,i,function(){d=!0}):u,d||(u&&h(u.then)?u.then(t):t(u)))),a||"get"!==g.method||g.target||(u=e.createElement("a"),u.href=g.action,u.host===r.host&&(n.preventDefault(),c=u.pathname+u.search,kn.set(("/"===c[0]?c:"/"+c)+(u.search?"&":"?")+f(O(g)))))}),L=!0,$H.run(),kn._debug={f:P,o:Q}},kn.serializeForm=O,kn.makeURI=function(e,n){return $(o,e,n)},kn.on=function(e,n,t){var r,i,a="";if(d(e)&&h(n))if(e=e.split(en),1===e.length)(r=V[e])&&(t&&((a=X[t])&&(t=a),a=t._id),(i=r[a])||(i=r[a]=[]),i.push(n));else for(a=e.length;a--;)kn.on(e[a],n,t);return kn},kn.off=function(e,n,t){var r,i="";if(d(e)&&h(n))if(e=e.split(en),1===e.length){if(t&&((i=X[t])&&(t=i),i=t._id),(r=V[e])&&(r=r[i]))for(i=r.length;i--;)r[i]===n&&r.splice(i,1)}else for(i=e.length;i--;)kn.on(e[i],n,t);return kn},kn.get=function(e){return X[e]},kn.params=function(){return K},kn.$={uri:function(e,n,t,r){var i=new vn(1);return i.u=e,i.p=n,i.r=t,i.e=r,i},"static":function(e){var n=new vn(2);return n.v=e,n},tpl:function(e,n,t){var r=new vn(3);return r.n=e,r.p=n,r.r=t,r},data:function(e){var n=new vn(4);return e&&e.uri||m("No URI"),n.v=e,n},refresh:function(e){var n,t,r=new vn(5),i=e.tags,a={};if(h(n=r.r=e.refresh)||"number"==typeof n||i&&d(i)||m("Wrong refresh"),r.o=e.timeout,r.j=(n=e.join)===o?!0:n,i)for(i=i.split(en),t=i.length;t--;)a[i[t]]=!0;return r.t=a,r}},kn.refresh=function(e){e=e.split(en),u(M,o,function(n,t,r,i){if(n._id in G&&(t=n.refresh)&&(r=t.t))for(i=e.length;i--;)e[i]in r&&T(n,0,t,!0)})},mn.reload=function(){var e,n=this;if(n._id in G){for(e=n[dn];e&&!e._l;)e=e[dn];e||(A(n,G,!0),new q(n))}},mn.params=function(){return this._p||o},mn.data=function(e){var n=this._data;return p(n)?-1===e?n:n[e||0]:o},mn.makeURI=function(e){return $(this,this.uri,e||{})},mn.active=function(e){return this._id in G&&(e?1===this._s:!0)},mn.checkForm=function(e){for(var n,t,r,i,a,f,u,s,l=e,h=this;l&&!(n=l[nn]);)l=l.parentNode;if(h===n&&(l=h.form)){for((t=e[n=nn+"f"])||(t=e[n]=new x(o,o,o,l,o,o,h,!0)),r=O(e,!0),i=t._fi=r[1],t._se=r=r[0],a=t.check,l=0;l<i.length;l++)f=i[l],u=a?a.call(h,f[0],f[1],r):o,c(h,t,f,u?(s=!0,on):an,u);return!s}},$H.on({search:function(e,t,r,i,a,f){for(f=function(e){e._a=0},t=P.length;t--;)u(P[t],o,f);for(K={},e=e.split("&"),t=0;t<e.length;t++)(i=e[t])&&(~(a=i.indexOf("="))?(a=i.substring(a+1),i=n(i.substring(0,i.length-a.length-1)),a=n(a)):a=gn,(f=K[i])?(p(f)||(f=[f]),f.push(a)):f=a,K[i]=f)}},{}),mn=F.prototype,mn.then=function(e,n){var t=this;e&&t.ok.push(e),n&&t.err.push(n),t.done()},mn.reject=function(){var e=this;e.d||(e.r&&(e.r.abort(),e.r=o),e.d=e.e=!0,e.done())},mn.done=function(){var e,n,t=this;if(t.d)for(t.e?(e=t.err,n=t.r):(e=t.ok,n=t.j);e.length;)e.shift()(n)},q.prototype.reject=function(){var e,n,t=this.datas;for(this.rejected=!0,e=t.length;e--;)n=t[e],h(n.abort)&&n.abort(),h(n.reject)&&n.reject()},kn}(document,decodeURIComponent,encodeURIComponent,location,setTimeout,clearTimeout);