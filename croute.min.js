/*!
 * conkitty-route v0.5.0, https://github.com/hoho/conkitty-route
 * (c) 2014 Marat Abdullin, MIT license
 */
window.$CR=function(e,n,t,r,i){"use strict";function a(e,n,r,i){for(n=[],r=0;r<e.length;r++)i=e[r],n.push(t(i.name)+"="+t(i.value));return n.join("&")}function o(e,n,t,r,i,a,f,u){for(!r&&n&&n(e),a=e.children,i=0;i<a.length&&!(u=o(f=a[i],n,t));i++);return!r&&t&&t(e)}function f(e,n,t,r,a){var o=n.state,f=t[0],u=o?o.call(e,f,r,a):i,c=t[2];t[2]=r,u===i&&(r===en&&c===tn&&(f.disabled=!1),r===tn&&(f.disabled?t[2]=c:f.disabled=!0))}function u(e,n,t){var r,i=n._fi;for(r=0;r<i.length;r++)f(e,n,i[r],t)}function c(e,n,t){t=new y(e,n),J.push(t)}function l(e){return"function"==typeof e}function s(e){return e instanceof Array}function h(e){return"string"==typeof e}function p(e){return e instanceof Node}function d(e){!!D!=!!e&&_("Running: "+!!D)}function _(e){throw new Error(e)}function m(e,n,t,r,i,a){if(r=G[e]){if(n=n.isForm?n[ln]:n,t=[e].concat(t||[]),(a=n._id)&&(i=r[a]))for(a=0;a<i.length;a++)i[a].apply(n,t);if(i=r[""])for(a=0;a<i.length;a++)i[a].apply(n,t)}}function g(e,n,t,r,i){return i="?"===e.charAt(1)?2:1,e=e.substring(i),e in n&&!t&&_("Duplicate param"),n[e]=i,e={param:e,optional:2===i},r&&r.push(e),r?"(?:/([^/]+))"+(2===i?"?":""):e}function v(e,t,r){var a,o,f,u,c,l,s,h={},p=[],d=[];for((e||"").replace(/^((?:(?:\:\?)|[^?#])*)(?:\?([^#]*))?(?:#(.*))?$/,function(e,n,t,r){a=(n||"").split("/"),o=(t||"").split("&"),f=r}),l=a.length,u=0;l>u;u++)((c=n(a[u]))||r&&u===l-1)&&p.push(":"===c.charAt(0)?g(c,h,t,t?i:d):t?c:"/"+c.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"));for(u=0;u<o.length;u++)(c=o[u])&&(s||(s={}),~(l=c.indexOf("="))?(l=c.substring(l+1),c=n(c.substring(0,c.length-l.length-1)),l=n(l)):l=hn,":"===c.charAt(0)&&_("Invalid queryparam"),c in s&&_("Duplicate queryparam"),s[c]=l&&":"===l.charAt(0)?g(l,h,t):{value:l});return f&&(f=":"===f.charAt(0)?g(f,h,t):{value:f}),{pathname:[p,d],search:s,hash:f,params:h}}function w(e,n,t,r,a,o,f,u){switch(t.param&&r&&(f=r[t.param]),!0){case"value"in t?t.value===n:n!==i&&!f:u=!0;break;case l(f):u=(n=f(n))!==i||t.optional;break;case n===i&&t.optional:u=!0;break;case f instanceof RegExp&&n!==i:u=f.test(n);break;case s(f):u=f.indexOf(n)>=0;break;case h(f):u=f===n;break;default:u=!1}return u&&n!==i&&(e!==i&&(a[e]=n),t&&t.param&&(o[t.param]=n)),u}function b(e,n){if(n=e._a)for(;e;)e._a-=n,e=e[ln]}function y(e,n,t,r,a,o){function f(e){e&&(mn(2,e)||mn(4,e)||h(e)||l(e))||_("Unexpected `"+e+"` as data source")}var u,c,p,d,m,g,T,x,C,j,$,A,E,F=this,H=/.*/,R={};if(F[ln]=a,F.children=[],F.uri=e,F._id="r"+ ++P,F._n={},n)if(F.title=n.title||a&&a.title,F[sn]=n[ln]||a&&a[sn],F.render=k(n.render),o)F.isForm=!0,(d=F.action=n.action)&&f(d),F._method=n.method,F.check=n.check,F.state=n.state,F.type=n.type,F[cn]=n[cn];else{$=n.params,(u=F.id=n.id)&&(u in z&&_("Duplicate id: "+u),z[u]=F),A=n.matcher,F.break=n.break,F.keep=n.keep,F.final=n.final,F.reduce=n.reduce,s(p=n.data)?F._da=!0:p=p!==i?[p]:[];for(u=0;u<p.length;u++)f(p[u]);if(F[Y]=p,F.form=n.form,F.wait=((u=n.wait)===i?a&&a.wait:u)||!1,m=n.on)for(d in G)if(p=m[d])for(s(p)||(p=[p]),u=0;u<p.length;u++)wn.on(d,p[u],F);F.refresh=n.refresh}if(e!==i&&(e=v(e),E=(t||[]).concat(e.pathname[0]),T=new RegExp(E.join("")+"(?:/(.*))?"),x=e.pathname[1],C=e.search,j=e.hash,r||(r=1),H=function(e){R={};var n,t=e.match(T);if(t){for(n=x.length;n--;)if(!w(i,t[r+n],x[n],$,i,R)){n=!1;break}if(n===!1||!C&&!j&&A&&!A.call(F,R))return b(F),!1;if((F._d=!t[r+x.length])&&F.final!==!1)for(F._a=1,n=a;n;)n._a++,n=n[ln]}return F._a?R:!1},(C||j)&&(H={pathname:H},C&&(H.search=function(){var e,n={};for(e in C)if(!w(e,U[e],C[e],$,n,R)){n=!1;break}return(n===!1||!j&&A&&!A.call(F,R))&&(b(F),n=!1),n}),j&&(H.hash=function(e){var n=!w(i,e||i,j,$,i,R)||A&&!A.call(F,R)?!1:e||!0;return n||b(F),n})),c=n&&n.frames))for(p in c)g=new y(p,c[p],F.reduce===!1?t:E,r+(F.reduce===!1?0:x.length),F),F.children.push(g);$H.on(H,{go:function(n){e||(F._a=1),F._p=R,F._s=n},leave:function(){F._p=hn}})}function k(e){function n(e){return h(e)||l(e)||mn(1,e)||mn(3,e)||e===hn}e=n(e)||s(e)?{success:e}:e||{};var t,r,a,o,f,u,c,p={},d=[rn,an,on,fn,un],m={"-":!1,"":i,"+":!0};for(t=d.length;t--;){r="",u=i;for(r in m)if(s(f=e[r+(o=d[t])])||f===i||(f=[f]),f){for(u||(u=[]),a=0;a<f.length;a++)n(c=f[a])||_("Unexpected `"+c+"` as a template"),u.push({s:m[r],v:c});p[o]=u}}return p}function T(e,n,t,r,a){return a=n.param,r=t&&a in t?t[a]:(r=e&&e._p)?r[a]:i}function x(e,n,r,a,o,f,u,c){var l,h,p,d,_;if(f||(a=[],o=[],f={}),!e||e&&e.reduce!==!1){for(n=v(n,!0,!r),p=n.pathname[0],l=p.length;l--;)d=p[l],_=d.param?T(e,d,r):d,_!==i&&a.unshift(t(_));if(p=n.search)for(l in p)if(!(l in f)){if(f[l]=!0,d=p[l],l=t(l),d.param){if(_=T(e,d,r),s(_)){for(h=0;h<_.length;h++)o.push(l+"="+t(_[h]));continue}}else _=d.value;_!==i&&o.push(l+"="+t(_))}!u&&(p=n.hash)&&(u=p.param?T(e,p,r):p.value)}return r&&e&&(l=e[ln])&&x(l,l.uri,r,a,o,f,u,!0),c?void 0:(a=("/"+a.join("/")).replace(/\/+/g,"/"),o.length&&(a+="?"+o.join("&")),u&&(a+="#"+t(u)),a)}function C(e,n,t,r,a,o,f,u,c,s,h){if(a=this,h=n.method,n=n.isForm?n[ln]:n,mn(4,e)&&(e=e.v)){if((f=e.override)&&(f=f.call(n,n._p))!==i)return{d:f};o=e.parse,u=e.transform,e=e.uri,l(e)&&(e=e.call(n,n._p),s=!0)}return a.ok=[],a.err=[],a.r=r=new XMLHttpRequest,r.open(h||"GET",r.uri=s?e:x(n,e),!0),r.onreadystatechange=function(){if(4===r.readyState){if(a.d=a.e=!0,200===r.status)try{c=r.responseText,c=o?o.call(n,c,r):JSON.parse(c),a.j=u?u.call(n,c,r):c,a.e=!1}catch(e){}a.done(),a.r=i}},t&&(t=t(r)),t===pn?t:void r.send(t)}function j(n,t,r,a,o,f){return a=t,n=n.isForm?n[ln]:n,h(r)&&(r=i),t=t||r||I,t&&!p(t)&&(t=l(t)?t.call(n):e.querySelector(t)),p(t)?((o=t._$Cid)||(t._$Cid=o=++P),f=n._n,f[o]||(f[o]=[r=e.createComment("")],t.appendChild(r))):t="No node `"+a+"`"+((a=n.id)?" ("+a+")":""),t}function $(n,t,r,a,o,f,u,c){var d,g,v,w,b,y,k,T,C,E,F,H="nextSibling";if(c=c===i?t[n]||N[n]||[]:c.s===i||c.s===o.active(!0)?c.v:i,s(c)){if(n===un&&!c.length)throw r[0];try{for(u={},d=0;d<c.length&&$(n,t,r,a,o,f,u,c[d])!==!1;d++);}catch(R){if(n===un)throw R;r=[R,n,d,c[d]],$(un,t,r,a,o,f,u),m(un,o,r),C=!0}}else if(c||c===hn){if(o.isForm&&(o=o[ln]),T=[o._da||n===un?r:r[0],o._p],f&&T.push(f),mn(1,c))l(d=c.u)?d=d.apply(o,T):(l(E=c.p)&&(E=E.apply(o,T)),d=x(i,d,E)),wn.set(d,c.r,c.e);else if(c){if(l(c)){if(v=c.apply(o,T),v===!1)return v;v===hn&&(c=hn),h(v)&&(d=v)}else d=h(c)?c:c.n,l(d)&&(v=d=d.apply(o,T));if(h(d)&&(T.unshift(d),v=S.apply(o,T),h(v)))for(d=e.createElement("div"),d.innerHTML=v,v=e.createDocumentFragment(),d=d.firstChild;d;)E=d[H],v.appendChild(d),d=E;if(v===!1)return v}if(!c||p(v)){if(A(B,0),b=j(o,c&&c.p,a),h(b)&&_(b),F=o._n,g=F[y=b._$Cid],k=g[0],!(y in u||c&&c.r===!1))for(d in F)d=F[d],u._&&d!==g||A(d,1);if(u[y]=u._=!0,c&&(w=k.parentNode))for(E=k.previousSibling,w.insertBefore(v,k),d=E?E[H]:w.firstChild;d!==k;d=d[H])g.push(d),d[W]=o}}return C}function A(e,n,t,r){for(;e.length>n;)r=e.pop(),(t=r.parentNode)&&t.removeChild(r)}function E(n,t,r,a){function f(e,n,t,r){if(e){if(t)for(r=n;r&&r._w2;r=r[ln])r._w2-=t;e._w2||!e._r||(r=e[ln])&&r._r||e._r(),o(e,f,i,!0)}}if(!n._l){var c,s,h,p=!t&&(n._data!==i||n._l)&&!n[Z],d=this,_=d.datas=[],g=n[Y],v=0,w=n.render,b=function(e,a,o,c,l,h,b){if(e!==i&&(_[e]=a,v--),!v&&!d.rejected&&(h=n[Z],c=n.children,p||(t&&h&&(n[Z]=i),n._l=i,b=n._data,n._data=_,n._r=function(e,a){if(n._r=i,e=j(n,n[sn]),a=h?t?hn:on:an,a&&t){for(l=!0,o=_.length;l&&o--;)s=g[o],l=l&&(mn(4,s)&&s.v.eq||$H.eq).call(n,_[o],b[o]);l&&(a=hn)}if(a){if($(a,w,h||_,e,n,r))return;if(!t){if(m(a,n,h||_),$(fn,w,h?[!0]:[],e,n,r))return;m(fn,n)}}!n.refresh||!b&&h||(n._u&&clearTimeout(n._u),n._u=setTimeout(function(){new E(n,!0),n._u=hn},n.refresh))},n.isForm&&(u(n[ln],n,en),n._r())),f(q,n,h||!n.wait&&!t?n._w2:1),!h))for(o=0;o<c.length;o++)l=c[o],l._id in K&&new E(l,t)};if(!p){if(n._l=d,d.u=t,n._w2=s=n._w,n.wait||t||f(q,n,s),e.title=(c=l(c=n.title)?c.call(n,n._p):c)===i?R:c,!t){if($(rn,w,[],j(n,n[sn]),n,r))return;m(rn,n)}for(h=function(e){v++,s.then(function(n){b(e,n)},function(t,r){(r=n[Z])||(r=n[Z]=new Array(_.length)),r[e]=t,b(e)})},c=0;c<g.length;c++)(s=g[c])&&(mn(2,s)?s=s.v:(l(s)||(s=new C(s,n,a),s.then||(s=s.d)),l(s)&&(s=s.call(n,n._p))),_.push(s),s&&l(s.then)&&h(c))}b()}}function F(e,n,t){var r,a,f;if(o(e,function(e){F(e,n)},i,!0),e._l&&(e._r=!e._l.u,e._l.reject(),e.isForm&&!e._c&&F(e[ln],n,!0)),e._u&&(clearTimeout(e._u),e._u=i),e._r&&m("stop",e),e._r=e._f=i,!(e._l===i&&e._data===i||(e._l=e._data=e[Z]=i,e._id in n))){m("leave",e),a=e._n,t=t?1:0;for(r in a)for(f=a[r];f.length>t;)B.push(f.pop());t||(e._n={})}}function H(e,n){var t,r,a,o,f,u,c,l=[],h=[];if(e instanceof HTMLFormElement)for(a=e.elements,t=0;t<a.length;t++){if(o=a[t],c=i,f=o.name)switch(o.type){case cn:case"reset":case"button":case"file":break;case"checkbox":case"radio":o.checked&&(c=o.value||"");break;case"select-multiple":for(u=o.options,c=[],r=0;r<u.length;r++)u[r].selected&&c.push(u[r].value);break;default:c=o.value||""}if(h.push([o,c]),!o.disabled&&c!==i)for(s(c)||(c=[c]),r=0;r<c.length;r++)l.push({name:f,value:c[r]})}return n?[l,h]:l}var R,N,I,S,D,U,q,L,M,O,K={},J=[],P=0,z={},B=[],G={before:{},success:{},error:{},after:{},stop:{},except:{},leave:{},busy:{},idle:{}},X=!1,Q=0,V=/[\x20\t\r\n\f]+/,W="_$Cf",Y="dataSource",Z="_dataError",en="valid",nn="invalid",tn="sending",rn="before",an="success",on="error",fn="after",un="except",cn="submit",ln="parent",sn="renderParent",hn=null,pn={d:hn},dn=y.prototype,_n=function(e){this.t=e},mn=function(e,n){return n instanceof _n&&n.t===e},gn=function(){},vn=function(e,n){var t=function(n){for(n in e)this[n]=e[n]};return t.prototype=n||new gn,new t},wn=function(e,n){return d(),h(e)&&h(n)?$H.on(e,n):e?c(e,n):M||(M=n),wn};return wn.add=wn,wn.set=function(e,n,t){return d(!0),L=n,$H.go(e,i,t)},wn.run=function(n){d();var t=e.body,f=t.addEventListener.bind(t);n=n||{},R=n.title||"",N=k(n.render),I=n[ln]||t,S=n.callTemplate||function(e,n,t,r,i,a){return(i=$C.tpl[e])||_("No `"+e+"` template"),a=[n,t,this],r&&a.push(r),i.apply(hn,a)},M&&c(i,M),$H.on(i,function(){var e,n,t,r,a={},f=0,u=0,c=function(e){e._w=0,e._p instanceof gn||(e._p=vn(e._p,(e=e[ln])&&e._p))},s=function(e,n,t){return e._a?(e._w++,a[n=e._id]=e,f++,r||n in K||(r=!0),l(t=e.break)&&(t=t.call(e)),(n=e[ln])&&(n._w+=e._w),!!t):void 0};for(n=0;n<J.length;n++)if(t=J[n],t._a){o(e=t,c,s);break}for(n in K)u++,t=K[n],n=n in a,(!n||L||!t._s||t.keep===!1||t[Z])&&F(t,a),n&&(t._s=1);!r&&u>f&&A(B,0),K=a,L=i,q=e,e&&new E(e)}),wn.on("before after stop",function(e){Q+=e===rn?1:-1,O&&clearTimeout(O),O=setTimeout(function(){e=X,X=!!Q,O=i,e!==X&&m(Q?"busy":"idle",wn)},0)}),f("click",function(e){for(var n=e.target;n&&!(n instanceof HTMLAnchorElement);)n=n.parentNode;!n||n.target||n.host!==r.host||e.altKey||e.ctrlKey||e.metaKey||e.shiftKey||1!==e.which||(e.preventDefault(),wn.set(n.href))},!1),f(cn,function(n){for(var t,o,f,c,s=n.target,h=s;s&&!(t=s[W]);)s=s.parentNode;t&&t.form&&(n.preventDefault(),t.checkForm(h)&&(o=h[W+"f"],K[o._id]=o,f=o._se,o[Y]=[l(c=h.getAttribute("action")||o.action)?wn.STATIC(c.call(h,f,t)):c||r.href],o.method=h.getAttribute("method")||o._method||"get",new E(o,i,h,function(e,n,r,c){return n=o.type,e.setRequestHeader("Content-Type","text"===n?"text/plain":"json"===n?"application/json":"application/x-www-form-urlencoded"),h.cancel=function(){o._c=c=pn},f=(r=o[cn])?r.call(h,f,e,t):f,delete h.cancel,c||u(t,o,tn),c||("json"===n?JSON.stringify(f):f?"text"===n?f+"":a(f):i)}))),o||"get"!==h.method||h.target||(f=e.createElement("a"),f.href=h.action,f.host===r.host&&(n.preventDefault(),c=f.pathname+f.search,wn.set(("/"===c[0]?c:"/"+c)+(f.search?"&":"?")+a(H(h)))))}),D=!0,$H.run(),wn._debug={f:J,o:B}},wn.serializeForm=H,wn.makeURI=function(e,n){return x(i,e,n)},wn.on=function(e,n,t){var r,i,a="";if(h(e)&&l(n))if(e=e.split(V),1===e.length)(r=G[e])&&(t&&((a=z[t])&&(t=a),a=t._id),(i=r[a])||(i=r[a]=[]),i.push(n));else for(a=e.length;a--;)wn.on(e[a],n,t);return wn},wn.off=function(e,n,t){var r,i="";if(h(e)&&l(n))if(e=e.split(V),1===e.length){if(t&&((i=z[t])&&(t=i),i=t._id),(r=G[e])&&(r=r[i]))for(i=r.length;i--;)r[i]===n&&r.splice(i,1)}else for(i=e.length;i--;)wn.on(e[i],n,t);return wn},wn.get=function(e){return z[e]},wn.params=function(){return U},wn.URI=function(e,n,t,r){var i=new _n(1);return i.u=e,i.p=n,i.r=t,i.e=r,i},wn.STATIC=function(e){var n=new _n(2);return n.v=e,n},wn.TEMPLATE=function(e,n,t){var r=new _n(3);return r.n=e,r.p=n,r.r=t,r},wn.DATA=function(e){var n=new _n(4);return e&&e.uri||_("No URI"),n.v=e,n},dn.reload=function(){var e,n=this;if(n._id in K){for(e=n[ln];e&&!e._l;)e=e[ln];e||(F(n,K,!0),new E(n))}},dn.params=function(e){var n=this;for(e=e||0;n&&e>0;)n=n[ln],e--;return n&&n._p||i},dn.data=function(e,n){var t,r=this;for(n=n||0;r&&n>0;)r=r[ln],n--;return t=r&&r._data,s(t)?-1===e?t:t[e||0]:i},dn.makeURI=function(e){return x(this,this.uri,e||{})},dn.active=function(e){return this._id in K&&(e?1===this._s:!0)},dn.checkForm=function(e){for(var n,t,r,a,o,u,c,l,s=e,h=this;s&&!(n=s[W]);)s=s.parentNode;if(h===n&&(s=h.form)){for((t=e[n=W+"f"])||(t=e[n]=new y(i,s,i,i,h,!0)),r=H(e,!0),a=t._fi=r[1],t._se=r=r[0],o=t.check,s=0;s<a.length;s++)u=a[s],c=o?o.call(h,u[0],u[1],r):i,f(h,t,u,c?(l=!0,nn):en,c);return!l}},$H.on({search:function(e,t,r,a,f,u){for(u=function(e){e._a=0},t=J.length;t--;)o(J[t],i,u);for(U={},e=e.split("&"),t=0;t<e.length;t++)(a=e[t])&&(~(f=a.indexOf("="))?(f=a.substring(f+1),a=n(a.substring(0,a.length-f.length-1)),f=n(f)):f=hn,(u=U[a])?(s(u)||(u=[u]),u.push(f)):u=f,U[a]=u)}},{}),dn=C.prototype,dn.then=function(e,n){var t=this;e&&t.ok.push(e),n&&t.err.push(n),t.done()},dn.reject=function(){var e=this;e.d||(e.r&&(e.r.abort(),e.r=i),e.d=e.e=!0,e.done())},dn.done=function(){var e,n,t=this;if(t.d)for(t.e?(e=t.err,n=t.r):(e=t.ok,n=t.j);e.length;)e.shift()(n)},E.prototype.reject=function(){var e,n,t=this.datas;for(this.rejected=!0,e=t.length;e--;)n=t[e],l(n.abort)&&n.abort(),l(n.reject)&&n.reject()},wn}(document,decodeURIComponent,encodeURIComponent,location);