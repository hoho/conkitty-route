/*!
 * conkitty-route v0.5.0, https://github.com/hoho/conkitty-route
 * (c) 2014 Marat Abdullin, MIT license
 */
window.$CR=function(e,n,t,r,i){"use strict";function a(e,n,r,i){for(n=[],r=0;r<e.length;r++)i=e[r],n.push(t(i.name)+"="+t(i.value));return n.join("&")}function o(e,n,t,r,i,a,f,c){for(!r&&n&&n(e),a=e.children,i=0;i<a.length&&!(c=o(f=a[i],n,t));i++);return!r&&t&&t(e)}function f(e,n,t,r,a){var o=n.state,f=t[0],c=o?o.call(e,f,r,a):i,u=t[2];t[2]=r,c===i&&(r===nn&&u===rn&&(f.disabled=!1),r===rn&&(f.disabled?t[2]=u:f.disabled=!0))}function c(e,n,t){var r,i=n._fi;for(r=0;r<i.length;r++)f(e,n,i[r],t)}function u(e,n,t){t=new y(e,n),P.push(t)}function l(e){return"function"==typeof e}function s(e){return e instanceof Array}function h(e){return"string"==typeof e}function p(e){return e instanceof Node}function d(e){!!U!=!!e&&_("Running: "+!!U)}function _(e){throw new Error(e)}function m(e,n,t,r,i,a){if(r=X[e]){if(n=n.isForm?n[sn]:n,t=[e].concat(t||[]),(a=n._id)&&(i=r[a]))for(a=0;a<i.length;a++)i[a].apply(n,t);if(i=r[""])for(a=0;a<i.length;a++)i[a].apply(n,t)}}function g(e,n,t,r,i){return i="?"===e.charAt(1)?2:1,e=e.substring(i),e in n&&!t&&_("Duplicate param"),n[e]=i,e={param:e,optional:2===i},r&&r.push(e),r?"(?:/([^/]+))"+(2===i?"?":""):e}function v(e,t,r){var a,o,f,c,u,l,s,h={},p=[],d=[];for((e||"").replace(/^((?:(?:\:\?)|[^?#])*)(?:\?([^#]*))?(?:#(.*))?$/,function(e,n,t,r){a=(n||"").split("/"),o=(t||"").split("&"),f=r}),l=a.length,c=0;l>c;c++)((u=n(a[c]))||r&&c===l-1)&&p.push(":"===u.charAt(0)?g(u,h,t,t?i:d):t?u:"/"+u.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"));for(c=0;c<o.length;c++)(u=o[c])&&(s||(s={}),~(l=u.indexOf("="))?(l=u.substring(l+1),u=n(u.substring(0,u.length-l.length-1)),l=n(l)):l=pn,":"===u.charAt(0)&&_("Invalid queryparam"),u in s&&_("Duplicate queryparam"),s[u]=l&&":"===l.charAt(0)?g(l,h,t):{value:l});return f&&(f=":"===f.charAt(0)?g(f,h,t):{value:f}),{pathname:[p,d],search:s,hash:f,params:h}}function w(e,n,t,r,a,o,f,c){switch(t.param&&r&&(f=r[t.param]),!0){case"value"in t?t.value===n:n!==i&&!f:c=!0;break;case l(f):c=(n=f(n))!==i||t.optional;break;case n===i&&t.optional:c=!0;break;case f instanceof RegExp&&n!==i:c=f.test(n);break;case s(f):c=f.indexOf(n)>=0;break;case h(f):c=f===n;break;default:c=!1}return c&&n!==i&&(e!==i&&(a[e]=n),t&&t.param&&(o[t.param]=n)),c}function b(e,n){if(n=e._a)for(;e;)e._a-=n,e=e[sn]}function y(e,n,t,r,a,o){function f(e){e&&(gn(2,e)||gn(4,e)||h(e)||l(e))||_("Unexpected `"+e+"` as data source")}var c,u,p,d,m,g,x,C,j,T,A,$,E,F=this,R=/.*/,H={};if(F[sn]=a,F.children=[],F.uri=e,F._id="r"+ ++z,F._n={},n)if(F.title=n.title||a&&a.title,F[hn]=n[sn]||a&&a[hn],F.render=k(n.render),o)F.isForm=!0,(d=F.action=n.action)&&f(d),F._method=n.method,F.check=n.check,F.state=n.state,F.type=n.type,F[ln]=n[ln];else{A=n.params,(c=F.id=n.id)&&(c in B&&_("Duplicate id: "+c),B[c]=F),$=n.matcher,F.break=n.break,F.keep=n.keep,F.final=n.final,F.reduce=n.reduce,s(p=n.data)?F._da=!0:p=p!==i?[p]:[];for(c=0;c<p.length;c++)f(p[c]);if(F[Z]=p,F.form=n.form,F.wait=((c=n.wait)===i?a&&a.wait:c)||!1,m=n.on)for(d in X)if(p=m[d])for(s(p)||(p=[p]),c=0;c<p.length;c++)bn.on(d,p[c],F)}if(e!==i&&(e=v(e),E=(t||[]).concat(e.pathname[0]),x=new RegExp(E.join("")+"(?:/(.*))?"),C=e.pathname[1],j=e.search,T=e.hash,r||(r=1),R=function(e){H={};var n,t=e.match(x);if(t){for(n=C.length;n--;)if(!w(i,t[r+n],C[n],A,i,H)){n=!1;break}if(n===!1||!j&&!T&&$&&!$.call(F,H))return b(F),!1;if((F._d=!t[r+C.length])&&F.final!==!1)for(F._a=1,n=a;n;)n._a++,n=n[sn]}return F._a?H:!1},(j||T)&&(R={pathname:R},j&&(R.search=function(){var e,n={};for(e in j)if(!w(e,L[e],j[e],A,n,H)){n=!1;break}return(n===!1||!T&&$&&!$.call(F,H))&&(b(F),n=!1),n}),T&&(R.hash=function(e){var n=!w(i,e||i,T,A,i,H)||$&&!$.call(F,H)?!1:e||!0;return n||b(F),n})),u=n&&n.frames))for(p in u)g=new y(p,u[p],F.reduce===!1?t:E,r+(F.reduce===!1?0:C.length),F),F.children.push(g);$H.on(R,{go:function(n){e||(F._a=1),F._p=H,F._s=n},leave:function(){F._p=pn}})}function k(e){function n(e){return h(e)||l(e)||gn(1,e)||gn(3,e)||e===pn}e=n(e)||s(e)?{success:e}:e||{};var t,r,a,o,f,c,u,p={},d=[an,on,fn,cn,un],m={"-":!1,"":i,"+":!0};for(t=d.length;t--;){r="",c=i;for(r in m)if(s(f=e[r+(o=d[t])])||f===i||(f=[f]),f){for(c||(c=[]),a=0;a<f.length;a++)n(u=f[a])||_("Unexpected `"+u+"` as a template"),c.push({s:m[r],v:u});p[o]=c}}return p}function x(e,n,t,r,a){return a=n.param,r=t&&a in t?t[a]:(r=e&&e._p)?r[a]:i}function C(e,n,r,a,o,f,c,u){var l,h,p,d,_;if(f||(a=[],o=[],f={}),!e||e&&e.reduce!==!1){for(n=v(n,!0,!r),p=n.pathname[0],l=p.length;l--;)d=p[l],_=d.param?x(e,d,r):d,_!==i&&a.unshift(t(_));if(p=n.search)for(l in p)if(!(l in f)){if(f[l]=!0,d=p[l],l=t(l),d.param){if(_=x(e,d,r),s(_)){for(h=0;h<_.length;h++)o.push(l+"="+t(_[h]));continue}}else _=d.value;_!==i&&o.push(l+"="+t(_))}!c&&(p=n.hash)&&(c=p.param?x(e,p,r):p.value)}return r&&e&&(l=e[sn])&&C(l,l.uri,r,a,o,f,c,!0),u?void 0:(a=("/"+a.join("/")).replace(/\/+/g,"/"),o.length&&(a+="?"+o.join("&")),c&&(a+="#"+t(c)),a)}function j(e,n,t,r,a,o,f,c,u,s,h){if(a=this,h=n.method,n=n.isForm?n[sn]:n,gn(4,e)&&(e=e.v)){if((f=e.override)&&(f=f.call(n,n._p))!==i)return{d:f};o=e.parse,c=e.transform,e=e.uri,l(e)&&(e=e.call(n,n._p),s=!0)}return a.ok=[],a.err=[],a.r=r=new XMLHttpRequest,r.open(h||"GET",r.uri=s?e:C(n,e),!0),r.onreadystatechange=function(){if(4===r.readyState){if(a.d=a.e=!0,200===r.status)try{u=r.responseText,u=o?o.call(n,u,r):JSON.parse(u),a.j=c?c.call(n,u,r):u,a.e=!1}catch(e){}a.done(),a.r=i}},t&&(t=t(r)),t===dn?t:void r.send(t)}function T(n,t,r,a,o,f){return a=t,n=n.isForm?n[sn]:n,h(r)&&(r=i),t=t||r||S,t&&!p(t)&&(t=l(t)?t.call(n):e.querySelector(t)),p(t)?((o=t._$Cid)||(t._$Cid=o=++z),f=n._n,f[o]||(f[o]=[r=e.createComment("")],t.appendChild(r))):t="No node `"+a+"`"+((a=n.id)?" ("+a+")":""),t}function A(n,t,r,a,o,f,c,u){var d,g,v,w,b,y,k,x,j,E,F,R="nextSibling";if(u=u===i?t[n]||I[n]||[]:u.s===i||u.s===o.active(!0)?u.v:i,s(u)){if(n===un&&!u.length)throw r[0];try{for(c={},d=0;d<u.length&&A(n,t,r,a,o,f,c,u[d])!==!1;d++);}catch(H){if(n===un)throw H;r=[H,n,d,u[d]],A(un,t,r,a,o,f,c),m(un,o,r),j=!0}}else if(u||u===pn){if(o.isForm&&(o=o[sn]),x=[o._da||n===un?r:r[0],o._p],f&&x.push(f),gn(1,u))l(d=u.u)?d=d.apply(o,x):(l(E=u.p)&&(E=E.apply(o,x)),d=C(i,d,E)),bn.set(d,u.r,u.e);else if(u){if(l(u)){if(v=u.apply(o,x),v===!1)return v;v===pn&&(u=pn),h(v)&&(d=v)}else d=h(u)?u:u.n,l(d)&&(v=d=d.apply(o,x));if(h(d)&&(x.unshift(d),v=D.apply(o,x),h(v)))for(d=e.createElement("div"),d.innerHTML=v,v=e.createDocumentFragment(),d=d.firstChild;d;)E=d[R],v.appendChild(d),d=E;if(v===!1)return v}if(!u||p(v)){if($(G,0),b=T(o,u&&u.p,a),h(b)&&_(b),F=o._n,g=F[y=b._$Cid],k=g[0],!(y in c||u&&u.r===!1))for(d in F)d=F[d],c._&&d!==g||$(d,1);if(c[y]=c._=!0,u&&(w=k.parentNode))for(E=k.previousSibling,w.insertBefore(v,k),d=E?E[R]:w.firstChild;d!==k;d=d[R])g.push(d),d[Y]=o}}return j}function $(e,n,t,r){for(;e.length>n;)r=e.pop(),(t=r.parentNode)&&t.removeChild(r)}function E(n,t,r,a){function f(e,n,t,r){if(e){if(t)for(r=n;r&&r._w2;r=r[sn])r._w2-=t;e._w2||!e._r||(r=e[sn])&&r._r||e._r(),o(e,f,i,!0)}}if(!n._l){var u,s,h,p=!t&&(n._data!==i||n._l)&&!n[en],d=this,_=d.datas=[],g=n[Z],v=0,w=n.render,b=function(e,a,o,u,l,s){if(e!==i&&(_[e]=a,v--),!v&&!d.rejected&&(s=n[en],u=n.children,p||(t&&s&&(n[en]=i),n._l=i,n._data=_,n._r=function(e,a){if(n._r=i,e=T(n,n[hn]),a=s?t?pn:fn:on){if(A(a,w,s||_,e,n,r))return;if(t||m(a,n,s||_),A(cn,w,s?[!0]:[],e,n,r))return;t||m(cn,n)}},n.isForm&&(c(n[sn],n,nn),n._r())),f(q,n,s||!n.wait&&!t?n._w2:1),!s))for(o=0;o<u.length;o++)l=u[o],l._id in J&&new E(l,t)};if(!p){if(n._l=d,n._u=t,n._w2=s=n._w,n.wait||t||f(q,n,s),e.title=(u=l(u=n.title)?u.call(n,n._p):u)===i?N:u,!t){if(A(an,w,[],T(n,n[hn]),n,r))return;m(an,n)}for(h=function(e){v++,s.then(function(n){b(e,n)},function(t,r){(r=n[en])||(r=n[en]=new Array(_.length)),r[e]=t,b(e)})},u=0;u<g.length;u++)(s=g[u])&&(gn(2,s)?s=s.v:(l(s)||(s=new j(s,n,a),s.then||(s=s.d)),l(s)&&(s=s.call(n,n._p))),_.push(s),s&&l(s.then)&&h(u))}b()}}function F(e,n,t){var r,a,f;if(o(e,function(e){F(e,n)},i,!0),e._l&&(e._l.reject(),e.isForm&&!e._c&&F(e[sn],n,!0),e._r=!0),e._r&&!e._u&&m("stop",e),e._r=e._f=i,!(e._l===i&&e._data===i||(e._l=e._data=e[en]=i,e._id in n))){m("leave",e),a=e._n,t=t?1:0;for(r in a)for(f=a[r];f.length>t;)G.push(f.pop());t||(e._n={})}}function R(e,n){var t,r,a,o,f,c,u,l=[],h=[];if(e instanceof HTMLFormElement)for(a=e.elements,t=0;t<a.length;t++){if(o=a[t],u=i,f=o.name)switch(o.type){case ln:case"reset":case"button":case"file":break;case"checkbox":case"radio":o.checked&&(u=o.value||"");break;case"select-multiple":for(c=o.options,u=[],r=0;r<c.length;r++)c[r].selected&&u.push(c[r].value);break;default:u=o.value||""}if(h.push([o,u]),!o.disabled&&u!==i)for(s(u)||(u=[u]),r=0;r<u.length;r++)l.push({name:f,value:u[r]})}return n?[l,h]:l}function H(){}var N,I,S,D,U,L,q,M,O,K,J={},P=[],z=0,B={},G=[],X={before:{},success:{},error:{},after:{},stop:{},except:{},leave:{},busy:{},idle:{}},Q=!1,V=0,W=/[\x20\t\r\n\f]+/,Y="_$Cf",Z="dataSource",en="_dataError",nn="valid",tn="invalid",rn="sending",an="before",on="success",fn="error",cn="after",un="except",ln="submit",sn="parent",hn="renderParent",pn=null,dn={d:pn},_n=y.prototype,mn=function(e){this.t=e},gn=function(e,n){return n instanceof mn&&n.t===e},vn=function(){},wn=function(e,n){var t=function(n){for(n in e)this[n]=e[n]};return t.prototype=n||new vn,new t},bn=function(e,n){return d(),h(e)&&h(n)?$H.on(e,n):e?u(e,n):O||(O=n),bn};return bn.add=bn,bn.set=function(e,n,t){return d(!0),M=n,$H.go(e,i,t)},bn.run=function(n){d();var t=e.body,f=t.addEventListener.bind(t);n=n||{},N=n.title||"",I=k(n.render),S=n[sn]||t,D=n.callTemplate||function(e,n,t,r,i,a){return(i=$C.tpl[e])||_("No `"+e+"` template"),a=[n,t,this],r&&a.push(r),i.apply(pn,a)},O&&u(i,O),$H.on(i,function(){var e,n,t,r,a={},f=0,c=0,u=function(e){e._w=0,e._p instanceof vn||(e._p=wn(e._p,(e=e[sn])&&e._p))},s=function(e,n,t){return e._a?(e._w++,a[n=e._id]=e,f++,r||n in J||(r=!0),l(t=e.break)&&(t=t.call(e)),(n=e[sn])&&(n._w+=e._w),!!t):void 0};for(n=0;n<P.length;n++)if(t=P[n],t._a){o(e=t,u,s);break}for(n in J)c++,t=J[n],n=n in a,(!n||M||!t._s||t.keep===!1||t[en])&&F(t,a),n&&(t._s=1);!r&&c>f&&$(G,0),J=a,M=i,q=e,e&&new E(e)}),bn.on("before after stop",function(e){V+=e===an?1:-1,K&&clearTimeout(K),K=setTimeout(function(){e=Q,Q=!!V,K=i,e!==Q&&m(V?"busy":"idle",bn)},0),H()}),f("click",function(e){for(var n=e.target;n&&!(n instanceof HTMLAnchorElement);)n=n.parentNode;!n||n.target||n.host!==r.host||e.altKey||e.ctrlKey||e.metaKey||e.shiftKey||1!==e.which||(e.preventDefault(),bn.set(n.href))},!1),f(ln,function(n){for(var t,o,f,u,s=n.target,h=s;s&&!(t=s[Y]);)s=s.parentNode;t&&t.form&&(n.preventDefault(),t.checkForm(h)&&(o=h[Y+"f"],J[o._id]=o,f=o._se,o[Z]=[l(u=h.getAttribute("action")||o.action)?bn.STATIC(u.call(h,f,t)):u||r.href],o.method=h.getAttribute("method")||o._method||"get",new E(o,i,h,function(e,n,r,u){return n=o.type,e.setRequestHeader("Content-Type","text"===n?"text/plain":"json"===n?"application/json":"application/x-www-form-urlencoded"),h.cancel=function(){o._c=u=dn},f=(r=o[ln])?r.call(h,f,e,t):f,delete h.cancel,u||c(t,o,rn),u||("json"===n?JSON.stringify(f):f?"text"===n?f+"":a(f):i)}))),o||"get"!==h.method||h.target||(f=e.createElement("a"),f.href=h.action,f.host===r.host&&(n.preventDefault(),u=f.pathname+f.search,bn.set(("/"===u[0]?u:"/"+u)+(f.search?"&":"?")+a(R(h)))))}),U=!0,$H.run(),bn._debug={f:P,o:G}},bn.serializeForm=R,bn.makeURI=function(e,n){return C(i,e,n)},bn.on=function(e,n,t){var r,i,a="";if(h(e)&&l(n))if(e=e.split(W),1===e.length)(r=X[e])&&(t&&((a=B[t])&&(t=a),a=t._id),(i=r[a])||(i=r[a]=[]),i.push(n));else for(a=e.length;a--;)bn.on(e[a],n,t);return bn},bn.off=function(e,n,t){var r,i="";if(h(e)&&l(n))if(e=e.split(W),1===e.length){if(t&&((i=B[t])&&(t=i),i=t._id),(r=X[e])&&(r=r[i]))for(i=r.length;i--;)r[i]===n&&r.splice(i,1)}else for(i=e.length;i--;)bn.on(e[i],n,t);return bn},bn.get=function(e){return B[e]},bn.params=function(){return L},bn.URI=function(e,n,t,r){var i=new mn(1);return i.u=e,i.p=n,i.r=t,i.e=r,i},bn.STATIC=function(e){var n=new mn(2);return n.v=e,n},bn.TEMPLATE=function(e,n,t){var r=new mn(3);return r.n=e,r.p=n,r.r=t,r},bn.DATA=function(e){var n=new mn(4);return e&&e.uri||_("No URI"),n.v=e,n},_n.reload=function(){var e,n=this;if(n._id in J){for(e=n[sn];e&&!e._l;)e=e[sn];e||(F(n,J,!0),new E(n))}},_n.params=function(e){var n=this;for(e=e||0;n&&e>0;)n=n[sn],e--;return n&&n._p||i},_n.data=function(e,n){var t,r=this;for(n=n||0;r&&n>0;)r=r[sn],n--;return t=r&&r._data,s(t)?-1===e?t:t[e||0]:i},_n.makeURI=function(e){return C(this,this.uri,e||{})},_n.active=function(e){return this._id in J&&(e?1===this._s:!0)},_n.checkForm=function(e){for(var n,t,r,a,o,c,u,l,s=e,h=this;s&&!(n=s[Y]);)s=s.parentNode;if(h===n&&(s=h.form)){for((t=e[n=Y+"f"])||(t=e[n]=new y(i,s,i,i,h,!0)),r=R(e,!0),a=t._fi=r[1],t._se=r=r[0],o=t.check,s=0;s<a.length;s++)c=a[s],u=o?o.call(h,c[0],c[1],r):i,f(h,t,c,u?(l=!0,tn):nn,u);return!l}},$H.on({search:function(e,t,r,a,f,c){for(c=function(e){e._a=0},t=P.length;t--;)o(P[t],i,c);for(L={},e=e.split("&"),t=0;t<e.length;t++)(a=e[t])&&(~(f=a.indexOf("="))?(f=a.substring(f+1),a=n(a.substring(0,a.length-f.length-1)),f=n(f)):f=pn,(c=L[a])?(s(c)||(c=[c]),c.push(f)):c=f,L[a]=c)}},{}),_n=j.prototype,_n.then=function(e,n){var t=this;e&&t.ok.push(e),n&&t.err.push(n),t.done()},_n.reject=function(){var e=this;e.d||(e.r&&(e.r.abort(),e.r=i),e.d=e.e=!0,e.done())},_n.done=function(){var e,n,t=this;if(t.d)for(t.e?(e=t.err,n=t.r):(e=t.ok,n=t.j);e.length;)e.shift()(n)},E.prototype.reject=function(){var e,n,t=this.datas;for(this.rejected=!0,e=t.length;e--;)n=t[e],l(n.abort)&&n.abort(),l(n.reject)&&n.reject()},bn}(document,decodeURIComponent,encodeURIComponent,location);