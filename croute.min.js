/*!
 * conkitty-route v0.5.0, https://github.com/hoho/conkitty-route
 * (c) 2014 Marat Abdullin, MIT license
 */
window.$CR=function(e,n,t,r,i){"use strict";function a(e,n,r,i){for(n=[],r=0;r<e.length;r++)i=e[r],n.push(t(i.name)+"="+t(i.value));return n.join("&")}function o(e,n,t,r,i,a,f){for(t&&t(e),e._w=0,i=e.children,r=0;r<i.length&&(f=o(a=i[r],n,t),e._w+=a._w,!f);r++);return n(e)}function f(e,n,t,r,a){var o=n.state,f=t[0],c=o?o.call(e,f,r,a):i,u=t[2];t[2]=r,c===i&&(r===en&&u===tn&&(f.disabled=!1),r===tn&&(f.disabled?t[2]=u:f.disabled=!0))}function c(e,n,t){var r,i=n._fi;for(r=0;r<i.length;r++)f(e,n,i[r],t)}function u(e,n,t){t=new y(e,n),J.push(t)}function l(e){return"function"==typeof e}function s(e){return e instanceof Array}function h(e){return"string"==typeof e}function p(e){return e instanceof Node}function d(e){!!D!=!!e&&_("Running: "+!!D)}function _(e){throw new Error(e)}function m(e,n,t,r,i,a){if(r=G[e]){if(n=n.isForm?n[ln]:n,t=[e].concat(t||[]),(a=n._id)&&(i=r[a]))for(a=0;a<i.length;a++)i[a].apply(n,t);if(i=r[""])for(a=0;a<i.length;a++)i[a].apply(n,t)}}function g(e,n,t,r,i){return i="?"===e.charAt(1)?2:1,e=e.substring(i),e in n&&!t&&_("Duplicate param"),n[e]=i,e={param:e,optional:2===i},r&&r.push(e),r?"(?:/([^/]+))"+(2===i?"?":""):e}function v(e,t,r){var a,o,f,c,u,l,s,h={},p=[],d=[];for((e||"").replace(/^((?:(?:\:\?)|[^?#])*)(?:\?([^#]*))?(?:#(.*))?$/,function(e,n,t,r){a=(n||"").split("/"),o=(t||"").split("&"),f=r}),l=a.length,c=0;l>c;c++)((u=n(a[c]))||r&&c===l-1)&&p.push(":"===u.charAt(0)?g(u,h,t,t?i:d):t?u:"/"+u.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"));for(c=0;c<o.length;c++)(u=o[c])&&(s||(s={}),~(l=u.indexOf("="))?(l=u.substring(l+1),u=n(u.substring(0,u.length-l.length-1)),l=n(l)):l=hn,":"===u.charAt(0)&&_("Invalid queryparam"),u in s&&_("Duplicate queryparam"),s[u]=l&&":"===l.charAt(0)?g(l,h,t):{value:l});return f&&(f=":"===f.charAt(0)?g(f,h,t):{value:f}),{pathname:[p,d],search:s,hash:f,params:h}}function w(e,n,t,r,a,o,f,c){switch(t.param&&r&&(f=r[t.param]),!0){case"value"in t?t.value===n:n!==i&&!f:c=!0;break;case l(f):c=(n=f(n))!==i||t.optional;break;case n===i&&t.optional:c=!0;break;case f instanceof RegExp&&n!==i:c=f.test(n);break;case s(f):c=f.indexOf(n)>=0;break;case h(f):c=f===n;break;default:c=!1}return c&&n!==i&&(e!==i&&(a[e]=n),t&&t.param&&(o[t.param]=n)),c}function b(e,n){if(n=e._a)for(;e;)e._a-=n,e=e[ln]}function y(e,n,t,r,a,o){function f(e){e&&(mn(2,e)||mn(4,e)||h(e)||l(e))||_("Unexpected `"+e+"` as data source")}var c,u,p,d,m,g,j,x,C,T,A,$,E,F=this,R=/.*/,H={};if(F[ln]=a,F.children=[],F.uri=e,F._id="r"+ ++P,F._n={},n)if(F.title=n.title||a&&a.title,F[sn]=n[ln]||a&&a[sn],F.render=k(n.render),o)F.isForm=!0,(d=F.action=n.action)&&f(d),F._method=n.method,F.check=n.check,F.state=n.state,F.type=n.type,F[un]=n[un];else{A=n.params,(c=F.id=n.id)&&(c in z&&_("Duplicate id: "+c),z[c]=F),$=n.matcher,F.break=n.break,F.keep=n.keep,F.final=n.final,F.reduce=n.reduce,s(p=n.data)?F._da=!0:p=p!==i?[p]:[];for(c=0;c<p.length;c++)f(p[c]);if(F[Y]=p,F.form=n.form,F.wait=((c=n.wait)===i?a&&a.wait:c)||!1,m=n.on)for(d in G)if(p=m[d])for(s(p)||(p=[p]),c=0;c<p.length;c++)wn.on(d,p[c],F)}if(e!==i&&(e=v(e),E=(t||[]).concat(e.pathname[0]),j=new RegExp(E.join("")+"(?:/(.*))?"),x=e.pathname[1],C=e.search,T=e.hash,r||(r=1),R=function(e){H={};var n,t=e.match(j);if(t){for(n=x.length;n--;)if(!w(i,t[r+n],x[n],A,i,H)){n=!1;break}if(n===!1||!C&&!T&&$&&!$.call(F,H))return b(F),!1;if((F._d=!t[r+x.length])&&F.final!==!1)for(F._a=1,n=a;n;)n._a++,n=n[ln]}return F._a?H:!1},(C||T)&&(R={pathname:R},C&&(R.search=function(){var e,n={};for(e in C)if(!w(e,U[e],C[e],A,n,H)){n=!1;break}return(n===!1||!T&&$&&!$.call(F,H))&&(b(F),n=!1),n}),T&&(R.hash=function(e){var n=!w(i,e||i,T,A,i,H)||$&&!$.call(F,H)?!1:e||!0;return n||b(F),n})),u=n&&n.frames))for(p in u)g=new y(p,u[p],F.reduce===!1?t:E,r+(F.reduce===!1?0:x.length),F),F.children.push(g);$H.on(R,{go:function(n){e||(F._a=1),F._p=H,F._s=n},leave:function(){F._p=hn}})}function k(e){function n(e){return h(e)||l(e)||mn(1,e)||mn(3,e)||e===hn}e=n(e)||s(e)?{success:e}:e||{};var t,r,a,o,f,c,u,p={},d=[rn,an,on,fn,cn],m={"-":!1,"":i,"+":!0};for(t=d.length;t--;){r="",c=i;for(r in m)if(s(f=e[r+(o=d[t])])||f===i||(f=[f]),f){for(c||(c=[]),a=0;a<f.length;a++)n(u=f[a])||_("Unexpected `"+u+"` as a template"),c.push({s:m[r],v:u});p[o]=c}}return p}function j(e,n,t,r,a){return a=n.param,r=t&&a in t?t[a]:(r=e&&e._p)?r[a]:i}function x(e,n,r,a,o,f,c,u){var l,h,p,d,_;if(f||(a=[],o=[],f={}),!e||e&&e.reduce!==!1){for(n=v(n,!0,!r),p=n.pathname[0],l=p.length;l--;)d=p[l],_=d.param?j(e,d,r):d,_!==i&&a.unshift(t(_));if(p=n.search)for(l in p)if(!(l in f)){if(f[l]=!0,d=p[l],l=t(l),d.param){if(_=j(e,d,r),s(_)){for(h=0;h<_.length;h++)o.push(l+"="+t(_[h]));continue}}else _=d.value;_!==i&&o.push(l+"="+t(_))}!c&&(p=n.hash)&&(c=p.param?j(e,p,r):p.value)}return r&&e&&(l=e[ln])&&x(l,l.uri,r,a,o,f,c,!0),u?void 0:(a=("/"+a.join("/")).replace(/\/+/g,"/"),o.length&&(a+="?"+o.join("&")),c&&(a+="#"+t(c)),a)}function C(e,n,t,r,a,o,f,c,u,s,h){if(a=this,h=n.method,n=n.isForm?n[ln]:n,mn(4,e)&&(e=e.v)){if((f=e.override)&&(f=f.call(n,n._p))!==i)return{d:f};o=e.parse,c=e.transform,e=e.uri,l(e)&&(e=e.call(n,n._p),s=!0)}return a.ok=[],a.err=[],a.r=r=new XMLHttpRequest,r.open(h||"GET",r.uri=s?e:x(n,e),!0),r.onreadystatechange=function(){if(4===r.readyState){if(a.d=a.e=!0,200===r.status)try{u=r.responseText,u=o?o.call(n,u,r):JSON.parse(u),a.j=c?c.call(n,u,r):u,a.e=!1}catch(e){}a.done(),a.r=i}},t&&(t=t(r)),t===pn?t:void r.send(t)}function T(n,t,r,a,o,f){return a=t,n=n.isForm?n[ln]:n,h(r)&&(r=i),t=t||r||I,t&&!p(t)&&(t=l(t)?t.call(n):e.querySelector(t)),p(t)?((o=t._$Cid)||(t._$Cid=o=++P),f=n._n,f[o]||(f[o]=[r=e.createComment("")],t.appendChild(r))):t="No node `"+a+"`"+((a=n.id)?" ("+a+")":""),t}function A(n,t,r,a,o,f,c,u){var d,g,v,w,b,y,k,j,C,E,F,R="nextSibling";if(u=u===i?t[n]||N[n]||[]:u.s===i||u.s===o.active(!0)?u.v:i,s(u)){if(n===cn&&!u.length)throw r[0];try{for(c={},d=0;d<u.length&&A(n,t,r,a,o,f,c,u[d])!==!1;d++);}catch(H){if(n===cn)throw H;r=[H,n,d,u[d]],A(cn,t,r,a,o,f,c),m(cn,o,r),C=!0}}else if(u||u===hn){if(o.isForm&&(o=o[ln]),j=[o._da||n===cn?r:r[0],o._p],f&&j.push(f),mn(1,u))l(d=u.u)?d=d.apply(o,j):(l(E=u.p)&&(E=E.apply(o,j)),d=x(i,d,E)),wn.set(d,u.r,u.e);else if(u){if(l(u)){if(v=u.apply(o,j),v===!1)return v;v===hn&&(u=hn),h(v)&&(d=v)}else d=h(u)?u:u.n,l(d)&&(v=d=d.apply(o,j));if(h(d)&&(j.unshift(d),v=S.apply(o,j),h(v)))for(d=e.createElement("div"),d.innerHTML=v,v=e.createDocumentFragment(),d=d.firstChild;d;)E=d[R],v.appendChild(d),d=E;if(v===!1)return v}if(!u||p(v)){if($(B,0),b=T(o,u&&u.p,a),h(b)&&_(b),F=o._n,g=F[y=b._$Cid],k=g[0],!(y in c||u&&u.r===!1))for(d in F)d=F[d],c._&&d!==g||$(d,1);if(c[y]=c._=!0,u&&(w=k.parentNode))for(E=k.previousSibling,w.insertBefore(v,k),d=E?E[R]:w.firstChild;d!==k;d=d[R])g.push(d),d[W]=o}}return C}function $(e,n,t,r){for(;e.length>n;)r=e.pop(),(t=r.parentNode)&&t.removeChild(r)}function E(n,t,r){function a(e,n,t,r){if(e){if(t)for(r=n;r&&r._w2;r=r[ln])r._w2-=t;for(e._w2||!e._r||(r=e[ln])&&r._r||e._r(),e=e.children,r=0;r<e.length;r++)a(e[r])}}if(!n._l){var o,f,u,s=(n._data!==i||n._l)&&!n[Z],h=this,p=h.datas=[],d=n[Y],_=0,g=n.render,v=function(e,r,o,f,u,l){if(e!==i&&(p[e]=r,_--),!_&&!h.rejected&&(l=n[Z],f=n.children,s||(n._l=i,n._data=p,n._r=function(e,r){n._r=i,e=T(n,n[sn]),r=l?on:an,A(r,g,l||p,e,n,t)||(m(r,n,l||p),A(fn,g,l?[!0]:[],e,n,t)||m(fn,n))},n.isForm&&(c(n[ln],n,en),n._r())),a(L,n,l||!n.wait?n._w2:1),!l))for(o=0;o<f.length;o++)u=f[o],u._id in K&&new E(u)};if(!s){if(n._l=h,n._w2=f=n._w,n.wait||a(L,n,f),e.title=(o=l(o=n.title)?o.call(n,n._p):o)===i?H:o,A(rn,g,[],T(n,n[sn]),n,t))return;for(m(rn,n),u=function(e){_++,f.then(function(n){v(e,n)},function(t,r){(r=n[Z])||(r=n[Z]=new Array(p.length)),r[e]=t,v(e)})},o=0;o<d.length;o++)(f=d[o])&&(mn(2,f)?f=f.v:(l(f)||(f=new C(f,n,r),f.then||(f=f.d)),l(f)&&(f=f.call(n,n._p))),p.push(f),f&&l(f.then)&&u(o))}v()}}function F(e,n,t){var r,a,o,f;for(r=e.children,a=r.length;a--;)F(r[a],n);if(e._l&&l(e._l.reject)&&(e._l.reject(),e.isForm&&!e._c&&F(e[ln],n,!0),e._r=!0),e._r&&m("stop",e),e._r=e._f=i,!(e._l===i&&e._data===i||(e._l=e._data=e[Z]=i,m("leave",e),e._id in n))){o=e._n,t=t?1:0;for(a in o)for(f=o[a];f.length>t;)B.push(f.pop());t||(e._n={})}}function R(e,n){var t,r,a,o,f,c,u,l=[],h=[];if(e instanceof HTMLFormElement)for(a=e.elements,t=0;t<a.length;t++){if(o=a[t],u=i,f=o.name)switch(o.type){case un:case"reset":case"button":case"file":break;case"checkbox":case"radio":o.checked&&(u=o.value||"");break;case"select-multiple":for(c=o.options,u=[],r=0;r<c.length;r++)c[r].selected&&u.push(c[r].value);break;default:u=o.value||""}if(h.push([o,u]),!o.disabled&&u!==i)for(s(u)||(u=[u]),r=0;r<u.length;r++)l.push({name:f,value:u[r]})}return n?[l,h]:l}var H,N,I,S,D,U,L,q,M,O,K={},J=[],P=0,z={},B=[],G={before:{},success:{},error:{},after:{},stop:{},except:{},leave:{},busy:{},idle:{}},X=!1,Q=0,V=/[\x20\t\r\n\f]+/,W="_$Cf",Y="dataSource",Z="_dataError",en="valid",nn="invalid",tn="sending",rn="before",an="success",on="error",fn="after",cn="except",un="submit",ln="parent",sn="renderParent",hn=null,pn={d:hn},dn=y.prototype,_n=function(e){this.t=e},mn=function(e,n){return n instanceof _n&&n.t===e},gn=function(){},vn=function(e,n){var t=function(n){for(n in e)this[n]=e[n]};return t.prototype=n||new gn,new t},wn=function(e,n){return d(),h(e)&&h(n)?$H.on(e,n):e?u(e,n):M||(M=n),wn};return wn.add=wn,wn.set=function(e,n,t){return d(!0),q=n,$H.go(e,i,t)},wn.run=function(n){d();var t=e.body,f=t.addEventListener.bind(t);n=n||{},H=n.title||"",N=k(n.render),I=n[ln]||t,S=n.callTemplate||function(e,n,t,r,i,a){return(i=$C.tpl[e])||_("No `"+e+"` template"),a=[n,t,this],r&&a.push(r),i.apply(hn,a)},M&&u(i,M),$H.on(i,function(){var e,n,t,r,a={},f=0,c=0,u=function(e,n,t){return e._a?(e._w++,a[n=e._id]=e,f++,r||n in K||(r=!0),l(t=e.break)&&(t=t.call(e)),!!t):void 0},s=function(e){e._p instanceof gn||(e._p=vn(e._p,(e=e[ln])&&e._p))};for(n=0;n<J.length;n++)if(t=J[n],t._a){o(e=t,u,s);break}for(n in K)c++,t=K[n],n=n in a,(!n||q||!t._s||t.keep===!1||t[Z])&&F(t,a),n&&(t._s=1);!r&&c>f&&$(B,0),K=a,q=i,L=e,e&&new E(e)}),wn.on("before after stop",function(e){Q+=e===rn?1:-1,O&&clearTimeout(O),O=setTimeout(function(){e=X,X=!!Q,O=i,e!==X&&m(Q?"busy":"idle",wn)},0)}),f("click",function(e){for(var n=e.target;n&&!(n instanceof HTMLAnchorElement);)n=n.parentNode;!n||n.target||n.host!==r.host||e.altKey||e.ctrlKey||e.metaKey||e.shiftKey||1!==e.which||(e.preventDefault(),wn.set(n.href))},!1),f(un,function(n){for(var t,o,f,u,s=n.target,h=s;s&&!(t=s[W]);)s=s.parentNode;t&&t.form&&(n.preventDefault(),t.checkForm(h)&&(o=h[W+"f"],K[o._id]=o,f=o._se,o[Y]=[l(u=h.getAttribute("action")||o.action)?wn.STATIC(u.call(h,f,t)):u||r.href],o.method=h.getAttribute("method")||o._method||"get",new E(o,h,function(e,n,r,u){return n=o.type,e.setRequestHeader("Content-Type","text"===n?"text/plain":"json"===n?"application/json":"application/x-www-form-urlencoded"),h.cancel=function(){o._c=u=pn},f=(r=o[un])?r.call(h,f,e,t):f,delete h.cancel,u||c(t,o,tn),u||("json"===n?JSON.stringify(f):f?"text"===n?f+"":a(f):i)}))),o||"get"!==h.method||h.target||(f=e.createElement("a"),f.href=h.action,f.host===r.host&&(n.preventDefault(),u=f.pathname+f.search,wn.set(("/"===u[0]?u:"/"+u)+(f.search?"&":"?")+a(R(h)))))}),D=!0,$H.run(),wn._debug={f:J,o:B}},wn.serializeForm=R,wn.makeURI=function(e,n){return x(i,e,n)},wn.on=function(e,n,t){var r,i,a="";if(h(e)&&l(n))if(e=e.split(V),1===e.length)(r=G[e])&&(t&&((a=z[t])&&(t=a),a=t._id),(i=r[a])||(i=r[a]=[]),i.push(n));else for(a=e.length;a--;)wn.on(e[a],n,t);return wn},wn.off=function(e,n,t){var r,i="";if(h(e)&&l(n))if(e=e.split(V),1===e.length){if(t&&((i=z[t])&&(t=i),i=t._id),(r=G[e])&&(r=r[i]))for(i=r.length;i--;)r[i]===n&&r.splice(i,1)}else for(i=e.length;i--;)wn.on(e[i],n,t);return wn},wn.get=function(e){return z[e]},wn.params=function(){return U},wn.URI=function(e,n,t,r){var i=new _n(1);return i.u=e,i.p=n,i.r=t,i.e=r,i},wn.STATIC=function(e){var n=new _n(2);return n.v=e,n},wn.TEMPLATE=function(e,n,t){var r=new _n(3);return r.n=e,r.p=n,r.r=t,r},wn.DATA=function(e){var n=new _n(4);return e&&e.uri||_("No URI"),n.v=e,n},dn.reload=function(){var e,n=this;if(n._id in K){for(e=n[ln];e&&!e._l;)e=e[ln];e||(F(n,K,!0),new E(n))}},dn.params=function(e){var n=this;for(e=e||0;n&&e>0;)n=n[ln],e--;return n&&n._p||i},dn.data=function(e,n){var t,r=this;for(n=n||0;r&&n>0;)r=r[ln],n--;return t=r&&r._data,s(t)?-1===e?t:t[e||0]:i},dn.makeURI=function(e){return x(this,this.uri,e||{})},dn.active=function(e){return this._id in K&&(e?1===this._s:!0)},dn.checkForm=function(e){for(var n,t,r,a,o,c,u,l,s=e,h=this;s&&!(n=s[W]);)s=s.parentNode;if(h===n&&(s=h.form)){for((t=e[n=W+"f"])||(t=e[n]=new y(i,s,i,i,h,!0)),r=R(e,!0),a=t._fi=r[1],t._se=r=r[0],o=t.check,s=0;s<a.length;s++)c=a[s],u=o?o.call(h,c[0],c[1],r):i,f(h,t,c,u?(l=!0,nn):en,u);return!l}},$H.on({search:function(e,t,r,i,a,f){for(f=function(e){e._a=0},t=J.length;t--;)o(J[t],f);for(U={},e=e.split("&"),t=0;t<e.length;t++)(i=e[t])&&(~(a=i.indexOf("="))?(a=i.substring(a+1),i=n(i.substring(0,i.length-a.length-1)),a=n(a)):a=hn,(f=U[i])?(s(f)||(f=[f]),f.push(a)):f=a,U[i]=f)}},{}),dn=C.prototype,dn.then=function(e,n){var t=this;e&&t.ok.push(e),n&&t.err.push(n),t.done()},dn.reject=function(){var e=this;e.d||(e.r&&(e.r.abort(),e.r=i),e.d=e.e=!0,e.done())},dn.done=function(){var e,n,t=this;if(t.d)for(t.e?(e=t.err,n=t.r):(e=t.ok,n=t.j);e.length;)e.shift()(n)},E.prototype.reject=function(){var e,n,t=this.datas;for(this.rejected=!0,e=t.length;e--;)n=t[e],l(n.abort)&&n.abort(),l(n.reject)&&n.reject()},wn}(document,decodeURIComponent,encodeURIComponent,location);