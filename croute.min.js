/*!
 * conkitty-route v0.6.5, https://github.com/hoho/conkitty-route
 * (c) 2014 Marat Abdullin, MIT license
 */
window.$CR=function(e,t,n,r,i,a,o){"use strict";function f(e,t,r,i){for(t=[],r=0;r<e.length;r++)i=e[r],t.push(n(i.name)+"="+n(i.value));return t.join("&")}function c(e,t,n,r,i,a,o,f){for(!r&&t&&t(e),a=e.children,i=0;i<a.length&&!(f=c(o=a[i],t,n));i++);return!r&&n&&n(e)}function u(e,t,n,r,i){var a=t.state,f=n[0],c=a?a.call(e,f,r,i):o,u=n[2];n[2]=r,c===o&&(r===it&&u===ot&&(f.disabled=!1),r===ot&&(f.disabled?n[2]=u:f.disabled=!0))}function s(e,t,n){var r,i=t._fi;for(r=0;r<i.length;r++)u(e,t,i[r],n)}function l(e,t){new x(P,o,e,t)}function h(e){return"function"==typeof e}function p(e){return e instanceof Array}function d(e){return"string"==typeof e}function _(e){return e instanceof Node}function g(e){!!I!=!!e&&m("Running: "+!!I)}function m(e){throw new Error(e)}function v(e,t,n,r,i,a){if(r=V[e]){if(t=t.isForm?t[pt]:t,n=[e].concat(n||[]),(a=t._id)&&(i=r[a]))for(a=0;a<i.length;a++)i[a].apply(t,n);if(i=r[""])for(a=0;a<i.length;a++)i[a].apply(t,n)}}function b(e,t,n,r,i){return i="?"===e.charAt(1)?2:1,e=e.substring(i),e in t&&!n&&m("Duplicate param"),t[e]=i,e={param:e,optional:2===i},r&&r.push(e),r?"(?:/([^/]+))"+(2===i?"?":""):e}function w(e,n,r){var i,a,f,c,u,s,l,h={},p=[],d=[];for((e||"").replace(/^((?:(?:\:\?)|[^?#])*)(?:\?([^#]*))?(?:#(.*))?$/,function(e,t,n,r){i=(t||"").split("/"),a=(n||"").split("&"),f=r}),s=i.length,c=0;s>c;c++)((u=t(i[c]))||r&&c===s-1)&&p.push(":"===u.charAt(0)?b(u,h,n,n?o:d):n?u:"/"+u.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"));for(c=0;c<a.length;c++)(u=a[c])&&(l||(l={}),~(s=u.indexOf("="))?(s=u.substring(s+1),u=t(u.substring(0,u.length-s.length-1)),s=t(s)):s=_t,":"===u.charAt(0)&&m("Invalid queryparam"),u in l&&m("Duplicate queryparam"),l[u]=s&&":"===s.charAt(0)?b(s,h,n):{value:s});return f&&(f=":"===f.charAt(0)?b(f,h,n):{value:f}),{pathname:[p,d],search:l,hash:f,params:h}}function y(e,t,n,r,i,a,f,c){switch(n.param&&r&&(f=r[n.param]),!0){case"value"in n?n.value===t:t!==o&&!f:c=!0;break;case h(f):c=(t=f(t))!==o||n.optional;break;case t===o&&n.optional:c=!0;break;case f instanceof RegExp&&t!==o:c=f.test(t);break;case p(f):c=f.indexOf(t)>=0;break;case d(f):c=f===t;break;default:c=!1}return c&&t!==o&&(e!==o&&(i[e]=t),n&&n.param&&(a[n.param]=t)),c}function k(e,t,n){if(!!(n=e._a)==!t)for(;e;)e._a+=t||-n,e=e[pt]}function x(e,t,n,r,i,a,f,c){function u(e){e&&(bt(2,e)||bt(4,e)||d(e)||h(e))||m("Unexpected `"+e+"` as data source")}var s,l,_,g,v,b,C,$,F,H,N,R,q=this,A=/.*/,E={};if(q[pt]=f,q.children=[],q.uri=n,q._id="r"+ ++W,q._n={},r){if(q.title=r.title||f&&f.title,q[dt]=r[pt]||f&&f[dt],q.render=j(r.render),c)q.isForm=!0,(g=q.action=r.action)&&u(g),q._method=r.method,q.check=r.check,q.state=r.state,q.type=r.type,q[ht]=r[ht],q.xhr=r.xhr;else{e.push(q),t&&(q._g=t,t.push(q)),H=r.params,(s=q.id=r.id)&&(s in X&&m("Duplicate id: "+s),X[s]=q),N=r.matcher,q.break=r.break,q.keep=r.keep,q.final=r.final,q.reduce=r.reduce,p(_=r.data)?q._da=!0:_=_!==o?[_]:[];for(s=0;s<_.length;s++)u(_[s]);if(q[nt]=_,q.form=r.form,q.wait=((s=r.wait)===o?f&&f.wait:s)||!1,v=r.on)for(g in V)if(_=v[g])for(p(_)||(_=[_]),s=0;s<_.length;s++)kt.on(g,_[s],q)}(s=g=r.refresh)&&(s=bt(5,s)?s:kt.$.refresh({refresh:s}),c?q.tags=Object.keys(s.t).join(" "):q.refresh=s)}if(n!==o&&(n=w(n),R=(i||[]).concat(n.pathname[0]),b=new RegExp(R.join("")+"(?:/(.*))?"),C=n.pathname[1],$=n.search,F=n.hash,a||(a=1),A=function(e){E={};var t,n=e.match(b);if(n){for(t=C.length;t--;)if(!y(o,n[a+t],C[t],H,o,E)){t=!1;break}if(t===!1||!$&&!F&&N&&!N.call(q,E))return k(q),!1;(q._d=!n[a+C.length])&&q.final!==!1&&k(q,1)}return q._a?E:!1},($||F)&&(A={pathname:A},$&&(A.search=function(){var e,t={};for(e in $)if(!y(e,L[e],$[e],H,t,E)){t=!1;break}return(t===!1||!F&&N&&!N.call(q,E))&&(k(q),t=!1),t}),F&&(A.hash=function(e){var t=!y(o,e||o,F,H,o,E)||N&&!N.call(q,E)?!1:e||!0;return t||k(q),t})),l=r&&r.frames))for(_ in l)for(p(g=l[_])?t=[]:(g=[g],t=o),s=0;s<g.length;s++)new x(q.children,t,_,g[s],q.reduce===!1?i:R,a+(q.reduce===!1?0:C.length),q);c||$H.on(A,{go:function(e){n||(q._a=1),q._p=E,q._s=e},leave:function(){q._p=_t}})}function j(e){function t(e){return d(e)||h(e)||bt(1,e)||bt(3,e)||e===_t}e=t(e)||p(e)?{success:e}:e||{};var n,r,i,a,f,c,u,s={},l=[ft,ct,ut,st,lt],_={"-":!1,"":o,"+":!0};for(n=l.length;n--;){r="",c=o;for(r in _)if(p(f=e[r+(a=l[n])])||f===o||(f=[f]),f){for(c||(c=[]),i=0;i<f.length;i++)t(u=f[i])||m("Unexpected `"+u+"` as a template"),c.push({s:_[r],v:u});s[a]=c}}return s}function C(e,t,n,r,i){return i=t.param,r=n&&i in n?n[i]:(r=e&&e._p)?r[i]:o}function $(e,t,r,i,a,f,c,u){var s,l,h,d,_;if(f||(i=[],a=[],f={}),r!==o&&"object"!=typeof r&&m("Invalid params `"+r+"`"),!e||e&&e.reduce!==!1){for(t=w(t,!0,!r),h=t.pathname[0],s=h.length;s--;)d=h[s],_=d.param?C(e,d,r):d,_!==o&&i.unshift(n(_));if(h=t.search)for(s in h)if(!(s in f)){if(f[s]=!0,d=h[s],s=n(s),d.param){if(_=C(e,d,r),p(_)){for(l=0;l<_.length;l++)a.push(s+"="+n(_[l]));continue}}else _=d.value;_!==o&&a.push(s+"="+n(_))}!c&&(h=t.hash)&&(c=h.param?C(e,h,r):h.value)}return r&&e&&(s=e[pt])&&$(s,s.uri,r,i,a,f,c,!0),u?void 0:(i=("/"+i.join("/")).replace(/\/+/g,"/"),a.length&&(i+="?"+a.join("&")),c&&(i+="#"+n(c)),i)}function F(e,t,n,r,i,a,f,c,u,s,l){if(i=this,l=t.method,t=t.isForm?t[pt]:t,bt(4,e)&&(e=e.v)){if((f=e.override)&&(f=f.call(t,t._p))!==o)return{o:f};l=e.method||l,a=e.parse,c=e.transform,e=e.uri,h(e)&&(e=e.call(t,t._p),s=!0)}h(l)&&(l=l.call(t,t._p)),i.ok=[],i.err=[],i.r=r=new XMLHttpRequest,r.open(r.method=(l||"GET").toUpperCase(),r.uri=s?e:$(t,e),!0),v("xhr",t,[r,!1]),r.onreadystatechange=function(){if(4===r.readyState){if(v("xhr",t,[r,!0]),i.d=i.e=!0,2===(r.status/100|0))try{u=r.responseText,u=a?a.call(t,u,r):204===r.status?o:JSON.parse(u),i.j=c?c.call(t,u,r):u,i.e=!1}catch(e){}i.done(),i.r=o}},n&&(n=n(r)),r.send(n)}function H(t,n,r,i,a,f){return i=n,t=t.isForm?t[pt]:t,d(r)&&(r=o),n=n||r||U,n&&!_(n)&&(n=h(n)?n.call(t):e.querySelector(n)),_(n)?((a=n._$Cid)||(n._$Cid=a=++W),f=t._n,f[a]||(f[a]=[r=e.createComment("")],n.appendChild(r))):n="No node `"+i+"`"+((i=t.id)?" ("+i+")":""),n}function N(t,n,r,i,a,f,c,u){var s,l,g,b,w,y,k,x,j,C,F,q="nextSibling";if(u=u===o?n[t]||S[t]||[]:u.s===o||u.s===a.active(!0)?u.v:o,p(u)){if(t===lt&&!u.length)throw r[0];try{for(c={},s=0;s<u.length&&N(t,n,r,i,a,f,c,u[s])!==!1;s++);}catch(A){if(t===lt)throw A;r=[A,t,s,u[s]],N(lt,n,r,i,a,f,c),v(lt,a,r),j=!0}}else if(u||u===_t){if(a.isForm&&(a=a[pt]),x=[a._da||t===lt?r:r[0],a._p],f&&x.push(f),h(u)&&(u=u.apply(a,x),u===!1||u===o))return u;if(bt(1,u))h(s=u.u)?s=s.apply(a,x):(h(C=u.p)&&(C=C.apply(a,x)),s=$(o,s,yt(C,a._p))),kt.set(s,u.r,u.e);else if(u){if(_(u)&&(g=u),s=d(u)?u:u.n,h(s)&&(g=s=s.apply(a,x)),d(s)&&(x.unshift(s),g=D.apply(a,x),d(g)))for(s=e.createElement("div"),s.innerHTML=g,g=e.createDocumentFragment(),s=s.firstChild;s;)C=s[q],g.appendChild(s),s=C;if(g===!1)return g}if(!u||_(g)){if(R(Q,0),w=H(a,u&&u.p,i),d(w)&&m(w),F=a._n,l=F[y=w._$Cid],k=l[0],!(y in c||u&&u.r===!1))for(s in F)s=F[s],c._&&s!==l||R(s,1);if(c[y]=c._=!0,u&&(b=k.parentNode))for(C=k.previousSibling,b.insertBefore(g,k),s=C?C[q]:b.firstChild;s!==k;s=s[q])l.push(s),s[tt]=a}}return j}function R(e,t,n,r){for(;e.length>t;)r=e.pop(),(n=r.parentNode)&&n.removeChild(r)}function q(t,n,r,i){function a(e,t,n,r){if(e){if(n)for(r=t;r&&r._w2;r=r[pt])r._w2-=n;e._w2||!e._r||(r=e[pt])&&r._r||e._r(),c(e,a,o,!0)}}if(t._l){if(!t._l.u)return;E(t)}var f,u,l,p=!n&&(t._data!==o||t._l)&&!t[rt],d=this,_=d.datas=[],g=t[nt],m=0,b=t.render,w=function(e,i,f,c,l,h,w,y){if(e!==o&&(_[e]=i,m--),!m&&!d.rejected){if(h=t[rt],c=t.children,!p){if(n&&h&&(t[rt]=o),t._l=o,w=t._data,t._data=_,y=h?n?_t:ut:ct,y&&1===n){for(l=!0,f=_.length;l&&f--;)u=g[f],l=l&&(bt(4,u)&&u.v.eq||$H.eq).call(t,_[f],w[f]);l?y=_t:n=2}t._r=function(e){if(t._r=o,e=H(t,t[dt]),y){if(N(y,b,h||_,e,t,r))return;if(!n){if(t.isForm&&y===ct&&t.tags&&kt.refresh(t.tags),v(y,t,h||_),N(st,b,h?[!0]:[],e,t,r))return;v(st,t)}}!(f=t.refresh)||f.r===o||!w&&h||T(t,f.r,f)},t.isForm&&(s(t[pt],t,it),t._r())}for(a(K,t,h||!t.wait&&!n?t._w2:1),f=0;f<c.length;f++)l=c[f],l._id in G&&(h?(A(l,{}),R(Q,0)):new q(l,n))}};if(!p){if(t._l=d,d.u=n,t._w2=u=t._w,t[rt]=o,t.wait||n||a(K,t,u),f=(f=h(f=t.title)?f.call(t,t._p):f)===o?O:f,f!==o&&(e.title=f),!n){if(N(ft,b,[],H(t,t[dt]),t,r))return;v(ft,t)}for(l=function(e){m++,u.then(function(t){w(e,t)},function(n,r){(r=t[rt])||(r=t[rt]=new Array(_.length)),r[e]=n,w(e)})},f=0;f<g.length;f++)(u=g[f])&&(bt(2,u)?u=u.v:h(u)?u=u.call(t,t._p):(u=new F(u,t,i),"o"in u&&(u=u.o)),_.push(u),u&&h(u.then)&&l(f))}w()}function A(e,t,n){var r,i,a;if(c(e,function(e){A(e,t)},o,!0),(r=e._l)&&(e._r=!r.u,e.isForm&&!e._c&&A(e[pt],t,!0)),E(e),e._r&&v("stop",e),e._r=e._f=o,!(r===o&&e._data===o&&!Object.keys(e._n).length||(e._l=e._data=e[rt]=o,e._id in t))){v("leave",e),i=e._n,n=n?1:0;for(r in i)for(a=i[r];a.length>n;)Q.push(a.pop());n||(e._n={})}}function E(e,t){(t=e._u)&&(a(t),e._u=o),(t=e._o)&&(a(t),e._o=o),(t=e._l)&&(t.reject(),e._l=o)}function T(e,t,n,r,a,f){h(t)&&(t=t.call(e)),t!==o&&(!(f=e._l)||f.u&&r)&&(E(e),a&&!n.j&&(t-=a),e._u=i(function(){e._u=_t,E(e),(a=n.o||0)&&(a=h(a)?a.call(e):a,e._o=i(function(){e._o=_t,T(e,n.r,n,!1,a)},a)),new q(e,1)},0>t?0:t))}function M(e,t){var n,r,i,a,f,c,u,s=[],l=[];if(e instanceof HTMLFormElement)for(i=e.elements,n=0;n<i.length;n++){if(a=i[n],u=o,f=a.name)switch(a.type){case ht:case"reset":case"button":case"file":break;case"checkbox":case"radio":a.checked&&(u=a.value||"");break;case"select-multiple":for(c=a.options,u=[],r=0;r<c.length;r++)c[r].selected&&u.push(c[r].value);break;default:u=a.value||""}if(l.push([a,u]),!a.disabled&&u!==o)for(p(u)||(u=[u]),r=0;r<u.length;r++)s.push({name:f,value:u[r]})}return t?[s,l]:s}var O,S,U,D,I,L,K,z,J,B,G={},P=[],W=0,X={},Q=[],V={before:{},success:{},error:{},after:{},stop:{},except:{},leave:{},busy:{},idle:{},xhr:{}},Y=!1,Z=0,et=/[\x20\t\r\n\f]+/,tt="_$Cf",nt="dataSource",rt="_dataError",it="valid",at="invalid",ot="sending",ft="before",ct="success",ut="error",st="after",lt="except",ht="submit",pt="parent",dt="renderParent",_t=null,gt="matches",mt=x.prototype,vt=function(e){this._=e},bt=function(e,t){return t instanceof vt&&t._===e},wt=function(){},yt=function(e,t){var n=function(t){for(t in e)this[t]=e[t]};return n.prototype=t||new wt,new n},kt=function(e,t){return g(),d(e)&&d(t)?l(e,{render:function(e,n){kt.set($(o,t,n),o,!0)}}):e?l(e,t):J||(J=t),kt};return kt.add=kt,kt.set=function(e,t,n){return g(!0),z=t,$H.go(e,o,n)},kt.run=function(t){g();for(var n=e.body,u=n.addEventListener.bind(n),p=["oM","msM","mozM","webkitM","m"];gt&&!n[gt];)gt=p.pop()+"atchesSelector";t=t||{},O=t.title,S=j(t.render),U=t[pt]||n,D=t.callTemplate||function(e,t,n,r,i,a){return(i=$C.tpl[e])||m("No `"+e+"` template"),a=[t,n,this],r&&a.push(r),i.apply(_t,a)},J&&l(o,J),$H.on(o,function(){var e,t,n,r,i={},a=0,f=0,u=function(e){e._w=0,e._p instanceof wt||(e._p=yt(e._p,(e=e[pt])&&e._p))},s=function(e,t,n){return e._a?(e._w++,i[t=e._id]=e,a++,r||t in G||(r=!0),h(n=e.break)&&(n=n.call(e)),(t=e[pt])&&(t._w+=e._w),!!n):void 0},l=function(e,t,n,r){if(t=e._g)for(n=t.length;n--;)if((r=t[n])._a){for(r=r._s,n=t.length;n--;)(e=t[n])._a||e.final===!1||k(e,1),e._s=r;break}};for(t=0;t<P.length;t++)if(n=P[t],n._a){c(e=n,o,l),c(n,u,s);break}for(t in G)f++,n=G[t],t=t in i,(!t||z||!n._s||n.keep===!1||n[rt])&&A(n,i),t&&(n._s=1);!r&&f>a&&R(Q,0),G=i,z=o,K=e,e&&new q(e)}),kt.on("before after stop",function(e){Z+=e===ft?1:-1,B&&a(B),B=i(function(){e=Y,Y=!!Z,B=o,e!==Y&&v(Z?"busy":"idle",kt)},0)}),u("click",function(e){for(var t=e.target;t&&!(t instanceof HTMLAnchorElement);)t=t.parentNode;!t||t.target||t.host!==r.host||e.altKey||e.ctrlKey||e.metaKey||e.shiftKey||1!==e.which||(e.preventDefault(),kt.set(t.href))},!1),u(ht,function(t){function n(e){u=h(u=g.getAttribute("action")||a.action)?u.call(g,e,i):u||r.href,l=a.type||"qs","get"===a.method&&"qs"===l&&(e.length&&(u+=(~u.indexOf("?")?"&":"?")+f(e)),e=o),"qs"!==l||e&&e.length||(e=l=o),a[nt]=[u],new q(a,o,g,function(t,n){return(e!==o||l!==o)&&t.setRequestHeader("Content-Type","text"===l?"text/plain":"json"===l?"application/json":"application/x-www-form-urlencoded"),(n=a.xhr)&&n.call(g,t,e,i),s(i,a,ot),"json"===l?JSON.stringify(e):e?"text"===l?e+"":f(e||[]):o})}for(var i,a,c,u,l,p,d,_=t.target,g=_;_&&!(i=_[tt]);)_=_.parentNode;i&&i.form&&((p=i.checkForm(g))!==o&&(t.preventDefault(),a=g[tt+"f"]),p&&(G[a._id]=a,c=a._se,a.method=(g.getAttribute("method")||a._method||"get").toLowerCase(),c=(p=a[ht])?p.call(g,c,i,function(){d=!0}):c,d||(c&&h(c.then)?c.then(n):n(c)))),a||"get"!==g.method||g.target||(c=e.createElement("a"),c.href=g.action,c.host===r.host&&(t.preventDefault(),u=c.pathname+c.search,kt.set(("/"===u[0]?u:"/"+u)+(c.search?"&":"?")+f(M(g)))))}),I=!0,$H.run(),kt._debug={f:P,o:Q}},kt.serializeForm=M,kt.makeURI=function(e,t){return $(o,e,t)},kt.on=function(e,t,n){var r,i,a="";if(d(e)&&h(t))if(e=e.split(et),1===e.length)(r=V[e])&&(n&&((a=X[n])&&(n=a),a=n._id),(i=r[a])||(i=r[a]=[]),i.push(t));else for(a=e.length;a--;)kt.on(e[a],t,n);return kt},kt.off=function(e,t,n){var r,i="";if(d(e)&&h(t))if(e=e.split(et),1===e.length){if(n&&((i=X[n])&&(n=i),i=n._id),(r=V[e])&&(r=r[i]))for(i=r.length;i--;)r[i]===t&&r.splice(i,1)}else for(i=e.length;i--;)kt.on(e[i],t,n);return kt},kt.get=function(e){return X[e]},kt.params=function(){return L},kt.$={uri:function(e,t,n,r){var i=new vt(1);return i.u=e,i.p=t,i.r=n,i.e=r,i},"static":function(e){var t=new vt(2);return t.v=e,t},tpl:function(e,t,n){var r=new vt(3);return r.n=e,r.p=t,r.r=n,r},data:function(e){var t=new vt(4);return e&&e.uri||m("No URI"),t.v=e,t},refresh:function(e){var t,n,r=new vt(5),i=e.tags,a={};if(h(t=r.r=e.refresh)||"number"==typeof t||i&&d(i)||m("Wrong refresh"),r.o=e.timeout,r.j=(t=e.join)===o?!0:t,i)for(i=i.split(et),n=i.length;n--;)a[i[n]]=!0;return r.t=a,r}},kt.refresh=function(e){e=e.split(et),c(K,o,function(t,n,r,i){if(t._id in G&&(n=t.refresh)&&(r=n.t))for(i=e.length;i--;)e[i]in r&&T(t,0,n,!0)})},mt.reload=function(){var e,t=this;if(t._id in G){for(e=t[pt];e&&!e._l;)e=e[pt];e||(A(t,G,!0),new q(t))}},mt.params=function(){return this._p||o},mt.data=function(e){var t=this._data;return p(t)?-1===e?t:t[e||0]:o},mt.makeURI=function(e){return $(this,this.uri,e||{})},mt.active=function(e){return this._id in G&&(e?1===this._s:!0)},mt.checkForm=function(e){for(var t,n,r,i,a,f,c,s,l,h,d=e,_=this;d&&!(r=d[tt]);)d=d.parentNode;if(_===r&&(d=_.form)){if(!(i=e[r=tt+"f"]))for(p(d)||(d=[d]),t=0;t<d.length;t++)if(n=d[t],!n.match||e[gt](n.match)){i=e[r]=new x(o,o,o,n,o,o,_,!0);break}if(i){for(a=M(e,!0),f=i._fi=a[1],i._se=a=a[0],c=i.check,d=0;d<f.length;d++)s=f[d],l=c?c.call(_,s[0],s[1],a):o,u(_,i,s,l?(h=!0,at):it,l);return!h}}},$H.on({search:function(e,n,r,i,a,f){for(f=function(e){e._a=0},n=P.length;n--;)c(P[n],o,f);for(L={},e=e.split("&"),n=0;n<e.length;n++)(i=e[n])&&(~(a=i.indexOf("="))?(a=i.substring(a+1),i=t(i.substring(0,i.length-a.length-1)),a=t(a)):a=_t,(f=L[i])?(p(f)||(f=[f]),f.push(a)):f=a,L[i]=f)}},{}),mt=F.prototype,mt.then=function(e,t){var n=this;e&&n.ok.push(e),t&&n.err.push(t),n.done()},mt.reject=function(){var e=this;e.d||(e.r&&(e.r.abort(),e.r=o),e.d=e.e=!0,e.done())},mt.done=function(){var e,t,n=this;if(n.d)for(n.e?(e=n.err,t=n.r):(e=n.ok,t=n.j);e.length;)e.shift()(t)},q.prototype.reject=function(){var e,t,n=this.datas;for(this.rejected=!0,e=n.length;e--;)t=n[e],h(t.abort)&&t.abort(),h(t.reject)&&t.reject()},kt}(document,decodeURIComponent,encodeURIComponent,location,setTimeout,clearTimeout);